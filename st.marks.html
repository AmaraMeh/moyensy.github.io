<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes ST LMD - Semestre 1 - ISET'COM</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"> <!-- Using Font Awesome 6.5.1 for consistency -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            /* Primary color adjusted to match index/st.html */
            --primary: 221.2 83.2% 53.3%; 
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96.1%;
            --secondary-foreground: 222.2 47.4% 11.2%;
            --muted: 210 40% 96.1%;
            --muted-foreground: 215.4 16.3% 46.9%;
            /* Accent color adjusted to match secondary in index/st.html */
            --accent: 210 40% 96.1%; 
            --accent-foreground: 222.2 47.4% 11.2%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 221.2 83.2% 53.3%; /* Same as primary */
            /* Radius adjusted to match index/st.html */
            --radius: 0.5rem; 
            --success: 142.1 76.2% 36.3%; /* Green */
            --warning: 38 92% 50%; /* Yellow */
            --error: 0 84.2% 60.2%; /* Red */
        }

        .dark {
            --background: 222.2 84% 4.9%;
            --foreground: 210 40% 98%;
            --card: 222.2 84% 4.9%;
            --card-foreground: 210 40% 98%;
            /* Primary color adjusted for dark mode to match index/st.html */
            --primary: 217.2 91.2% 59.8%; 
            --primary-foreground: 222.2 47.4% 11.2%;
            --secondary: 217.2 32.6% 17.5%;
            --secondary-foreground: 210 40% 98%;
            --muted: 217.2 32.6% 17.5%;
            --muted-foreground: 215 20.2% 65.1%;
            /* Accent color adjusted for dark mode to match secondary */
            --accent: 217.2 32.6% 17.5%; 
            --accent-foreground: 210 40% 98%;
            --border: 217.2 32.6% 17.5%;
            --input: 217.2 32.6% 17.5%;
            --ring: 224.3 76.3% 48%; /* Slightly different ring in dark mode */
            --success: 142.1 70.6% 45.3%; /* Darker Green */
            --warning: 48 96.5% 53.9%; /* Darker Yellow */
            --error: 0 84.2% 60.2%; /* Red (same) */
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: hsl(var(--background));
            color: hsl(var(--foreground));
            min-height: 100vh; /* Keep min-height for layout */
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.3s ease, color 0.3s ease;
            padding-top: 80px; /* Add padding to prevent content from going under sticky header */
        }

        /* Hero Background styles copied from index/st.html */
        .hero-bg { position: fixed; inset: 0; z-index: -10; overflow: hidden; } 
        .gradient-blob { position: absolute; border-radius: 9999px; filter: blur(60px); opacity: 0.5; }
        .gradient-blob-1 { top: 0; left: 0; right: 0; height: 500px; background: linear-gradient(to bottom right, hsl(var(--primary) / 0.4), hsl(var(--ring) / 0.2), hsl(var(--accent) / 0.1)); transform: translateY(-50%); }
        .gradient-blob-2 { bottom: 0; right: 0; width: 500px; height: 500px; background: linear-gradient(to top right, hsl(var(--ring) / 0.3), hsl(var(--accent) / 0.2), transparent); }
        .floating-dot { position: absolute; border-radius: 9999px; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 0.5; transform: scale(1); } 50% { opacity: 1; transform: scale(1.2); } }

        /* Floating Particles styles copied from index/st.html */
        .floating-particles { position: fixed; inset: 0; overflow: hidden; pointer-events: none; z-index: -5; } 
        .particle { position: absolute; border-radius: 50%; opacity: 0.7; animation: float 10s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.3; } 50% { transform: translate(var(--x), var(--y)) scale(1.2); opacity: 0.8; } }
        /* Particles colors adapted for ST page theme */
        .particle-blue { background-color: hsl(var(--primary)); }
        .particle-green { background-color: hsl(var(--success)); }
        .particle-yellow { background-color: hsl(var(--warning)); }


        /* Header styles adapted from index/st.html */
        .header-section {
            position: fixed; 
            top: 0;
            left: 0;
            right: 0;
            /* Use background with opacity and blur like index/st.html */
            background: hsl(var(--background) / 0.8); 
            backdrop-filter: blur(8px);
            /* Use shadow like index/st.html */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
            border-bottom: none; /* Remove border-bottom */
            z-index: 50;
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            padding: 1rem 0; 
        }
        .dark .header-section {
            background: hsl(var(--background) / 0.9);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        img[alt="ISET'COM Logo"] { 
            max-width: 60px; /* Adjusted size to fit header better */
            height: auto; /* Maintain aspect ratio */
            transition: transform 0.3s ease; 
        } 
        img[alt="ISET'COM Logo"]:hover { transform: scale(1.05); }
        .dark img[alt="ISET'COM Logo"] { filter: brightness(0.9); /* Less harsh filter */ }

        /* Main Content Card styles adapted from index/st.html */
        .main-content-card {
            /* Use background with opacity and blur like index/st.html service cards */
            background: hsl(var(--card) / 0.8); 
            backdrop-filter: blur(10px); 
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius); 
            padding: 2rem; 
            /* Adjusted box-shadow */
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); 
            margin-top: 1rem;
            visibility: hidden; 
        }
        .dark .main-content-card { background: hsl(var(--card) / 0.9); border-color: hsl(var(--border)); }

        /* Filters Container styles */
        .filters-container {
            margin-bottom: 2rem; padding: 1.5rem; 
            /* Use secondary background with some opacity */
            background: hsl(var(--secondary) / 0.5); 
            border-radius: var(--radius); 
            border: 1px solid hsl(var(--border));
        }
        .dark .filters-container { background: hsl(var(--secondary) / 0.3); border-color: hsl(var(--border) / 0.5); }

        /* Page Title style - keep gradient effect idea */
        .page-title {
            font-size: 1.75rem; font-weight: 600; margin-bottom: 1.5rem; text-align: center;
            /* Use gradient for title */
            background: linear-gradient(135deg, hsl(var(--primary)), hsl(var(--ring)));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .dark .page-title { 
             background: linear-gradient(135deg, hsl(var(--primary)), hsl(var(--ring)));
             -webkit-background-clip: text;
             background-clip: text;
             color: transparent;
        }


        .filters-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
        .filter-group { display: flex; flex-direction: column; }
        .filter-label { font-size: 0.875rem; font-weight: 500; margin-bottom: 0.25rem; color: hsl(var(--muted-foreground)); }
        .filter-select {
            padding: 0.6rem 0.8rem; border: 1px solid hsl(var(--border)); border-radius: var(--radius); /* Use --radius */
            background: hsl(var(--input)); /* Use --input for consistency */
            color: hsl(var(--foreground)); 
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .filter-select:focus { outline: none; border-color: hsl(var(--primary)); box-shadow: 0 0 0 2px hsl(var(--primary) / 0.2); }
        .dark .filter-select { background: hsl(var(--input)); border-color: hsl(var(--border)); color: hsl(var(--foreground)); }

        /* Back button style */
        .back-button {
            display: inline-flex; align-items: center; gap: 0.5rem; color: hsl(var(--primary)); font-weight: 500;
            transition: all 0.3s ease; padding: 0.5rem 1rem; border-radius: 9999px; 
            /* Use primary color with opacity like other buttons */
            background: hsl(var(--primary) / 0.1); 
        }
        .back-button:hover { background: hsl(var(--primary) / 0.2); transform: translateX(-3px); }
        .dark .back-button { color: hsl(var(--primary)); background: hsl(var(--primary) / 0.2); }
        .dark .back-button:hover { background: hsl(var(--primary) / 0.3); }


        /* Table Styles */
        .table-wrapper { overflow-x: auto; }
        .table-scroll { max-height: 60vh; overflow-y: auto; border: 1px solid hsl(var(--border)); border-radius: var(--radius); }
        #marksTable { width: 100%; border-collapse: collapse; }
        #marksTable th, #marksTable td {
            padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid hsl(var(--border)); white-space: nowrap;
        }
        #marksTable th {
            background: hsl(var(--secondary)); font-weight: 600; color: hsl(var(--secondary-foreground));
            font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em;
        }
        .dark #marksTable th { background: hsl(var(--secondary)); color: hsl(var(--secondary-foreground)); }
        #marksTable tbody tr:hover { background-color: hsl(var(--secondary) / 0.5); }
        .dark #marksTable tbody tr:hover { background-color: hsl(var(--secondary) / 0.3); }

        .sticky-header { position: sticky; top: 0; z-index: 10; background: hsl(var(--secondary)); } /* Explicitly set sticky header background */
        .dark .sticky-header { background: hsl(var(--secondary)); } /* Explicitly set sticky header background in dark mode */
        
        .name-column { min-width: 200px; }
        .grade-column { text-align: center; min-width: 80px; }
        .text-cell { font-size: 0.875rem; color: hsl(var(--muted-foreground)); }
        .dark .text-cell { color: hsl(var(--muted-foreground)); }
        .grade-cell { text-align: center; font-weight: 500; font-size: 0.9rem; }
        .name-cell { font-weight: 500; }

        /* Grade Coloring */
        .grade-passing { color: hsl(var(--success)); }
        .dark .grade-passing { color: hsl(var(--success)); }
        .grade-failing { color: hsl(var(--error)); }
        .dark .grade-failing { color: hsl(var(--error)); }

        /* Founder Styling */
        .founder-row { background-color: hsl(var(--warning) / 0.1) !important; }
        .dark .founder-row { background-color: hsl(var(--warning) / 0.15) !important; }
        .founder-badge {
            display: inline-block; margin-left: 0.5rem; padding: 0.1rem 0.4rem; font-size: 0.7rem;
            font-weight: bold; color: hsl(var(--warning) / 1.2); background-color: hsl(var(--warning) / 0.2);
            border: 1px solid hsl(var(--warning) / 0.5); border-radius: 9999px; vertical-align: middle;
        }
        .dark .founder-badge { color: hsl(var(--warning)); background-color: hsl(var(--warning) / 0.25); border-color: hsl(var(--warning) / 0.6); }


        /* Sorting */
        .sortable { cursor: pointer; position: relative; padding-right: 1.5rem !important; }
        .sort-indicator {
            position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%);
            width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent;
            opacity: 0.4; transition: opacity 0.2s ease;
        }
        .sortable:hover .sort-indicator { opacity: 0.7; }
        .sort-indicator.sort-asc { border-bottom: 6px solid hsl(var(--foreground)); border-top: 0; opacity: 1; }
        .sort-indicator.sort-desc { border-top: 6px solid hsl(var(--foreground)); border-bottom: 0; opacity: 1; }
        .dark .sort-indicator.sort-asc { border-bottom-color: hsl(var(--foreground)); }
        .dark .sort-indicator.sort-desc { border-top-color: hsl(var(--foreground)); }

        /* Auth Overlay (Login Popup) Styles adapted from popup styles in st.html */
        .popup { 
            position: fixed; inset: 0; 
            /* Use standard background blur */
            background: hsla(var(--background), 0.5); 
            backdrop-filter: blur(8px);
            display: none; align-items: center; justify-content: center; z-index: 1000; padding: 1rem; opacity: 0; transition: opacity 0.3s ease;
        }
        .popup.active { display: flex; opacity: 1; }
        .popup-content-wrapper { /* Specific wrapper for content */
            /* Use standard card styles */
            background: hsl(var(--card)); 
            border: 1px solid hsl(var(--border)); 
            border-radius: var(--radius); 
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15); width: 100%; max-width: 450px; 
            overflow: hidden; display: flex; flex-direction: column; transform: scale(0.95) translateY(10px);
            transition: transform 0.3s ease, opacity 0.3s ease; padding: 2.5rem; text-align: center; 
        }
        .popup.active .popup-content-wrapper { transform: scale(1) translateY(0); opacity: 1; }
        .dark .popup-content-wrapper { background: hsl(var(--card)); border-color: hsl(var(--border)); } /* No opacity needed in dark card */
        
        .popup-content-wrapper h2 { /* Title inside the box */
            margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 600; 
            /* Use gradient like page title */
            background: linear-gradient(135deg, hsl(var(--primary)), hsl(var(--ring)));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .dark .popup-content-wrapper h2 {
             background: linear-gradient(135deg, hsl(var(--primary)), hsl(var(--ring)));
             -webkit-background-clip: text;
             background-clip: text;
             color: transparent;
        }

        .popup-content-wrapper input[type="password"] {
            width: 100%; padding: 0.75rem; font-size: 1rem; border: 1px solid hsl(var(--border)); border-radius: var(--radius); /* Use --radius */
            margin-bottom: 1.5rem; 
            /* Use standard input background */
            background: hsl(var(--input)); 
            color: hsl(var(--foreground));
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .dark .popup-content-wrapper input[type="password"] { background: hsl(var(--input)); border-color: hsl(var(--border)); color: hsl(var(--foreground)); }
        .popup-content-wrapper input[type="password"]:focus { outline: none; border-color: hsl(var(--primary)); box-shadow: 0 0 0 2px hsl(var(--primary) / 0.2); }
        
        .popup-content-wrapper button { /* Login button - style like module-btn */
            width: 100%; padding: 0.75rem; font-size: 1rem; 
            background: hsl(var(--primary)); 
            color: hsl(var(--primary-foreground));
            border: none; border-radius: var(--radius); /* Use --radius */
            cursor: pointer; transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
        }
        .popup-content-wrapper button:hover { background: hsl(var(--primary) / 0.9); transform: translateY(-2px); box-shadow: 0 4px 8px hsl(var(--primary) / 0.2); }
        .dark .popup-content-wrapper button { background: hsl(var(--primary)); color: hsl(var(--primary-foreground)); }
        .dark .popup-content-wrapper button:hover { background: hsl(var(--primary) / 0.9); }
        
        .popup-content-wrapper .login-error {
            display: none; color: hsl(var(--error)); margin-top: 1rem; font-size: 0.9rem;
        }
        .popup-content-wrapper .auth-message {
            margin-top: 1.5rem; font-size: 0.85rem; color: hsl(var(--muted-foreground)); line-height: 1.5;
        }
        /* Instagram link color */
        .instagram-link { color: #E1306C; text-decoration: none; font-weight: 500; transition: color 0.3s ease, text-decoration 0.3s ease; }
        .instagram-link:hover { text-decoration: underline; color: #C13584; }
        .dark .instagram-link { color: #F56040; } /* Adjusted for dark mode visibility */
        .dark .instagram-link:hover { color: #FF7D64; }


        /* Theme Toggle styles copied from index/st.html */
        .theme-toggle {
            position: fixed; bottom: 1rem; right: 1rem; z-index: 1001; 
            width: 3rem; height: 3rem; border-radius: 9999px;
            background: hsl(var(--card)); border: 1px solid hsl(var(--border)); display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .theme-toggle:hover { transform: translateY(-2px) scale(1.05); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15); }
        /* Theme toggle icon color slightly adjusted for consistency */
        .theme-toggle i { font-size: 1.25rem; color: hsl(var(--foreground)); transition: transform 0.4s ease, color 0.3s ease; } 
        .dark .theme-toggle i { color: hsl(var(--foreground)); } 
        .theme-toggle:hover i { transform: rotate(20deg) scale(1.1); }
        .dark .theme-toggle { background: hsl(var(--card)); border-color: hsl(var(--border)); }


        /* Add shake animation CSS */
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        .animate-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; transform: translate3d(0, 0, 0); }

         /* Footer styles copied from index/st.html */
        footer {
             text-center text-gray-600 dark:text-gray-400 text-sm py-6 border-t border-gray-200 dark:border-gray-700 mt-12; /* Keep original footer classes */
             background: hsl(var(--background) / 0.8); /* Match header blur/opacity */
             backdrop-filter: blur(8px);
        }
        .dark footer {
            background: hsl(var(--background) / 0.9);
        }

        /* Link styles in footer */
        footer a {
            color: hsl(var(--primary));
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease, text-decoration 0.3s ease;
        }
        footer a:hover {
            color: hsl(var(--primary) / 0.8);
            text-decoration: underline;
        }
        .dark footer a {
            color: hsl(var(--primary));
        }
        .dark footer a:hover {
            color: hsl(var(--primary) / 0.8);
        }


    </style>
</head>
<body class="flex flex-col"> 
    <!-- Hero Background -->
    <div class="hero-bg">
        <div class="gradient-blob gradient-blob-1"></div>
        <div class="gradient-blob gradient-blob-2"></div>
        <!-- Floating dots with colors from index/st.html -->
        <div class="floating-dot w-4 h-4 bg-blue-500 top-1/4 left-1/4"></div>
        <div class="floating-dot w-3 h-3 bg-purple-500 top-1/3 right-1/4"></div>
        <div class="floating-dot w-2 h-2 bg-green-500 bottom-1/4 left-1/3"></div>
        <div class="floating-dot w-3 h-3 bg-amber-500 top-2/3 right-1/3"></div>
    </div>

    <!-- Floating Particles -->
    <div class="floating-particles" id="particles"></div>

    <!-- Header -->
    <header class="header-section">
        <div class="container mx-auto px-4 max-w-7xl flex items-center justify-between"> 
            <div class="flex items-center gap-3">
                <img src="assets/img/LOGO.png" alt="ISET'COM Logo" />
                 <h1 class="text-xl md:text-2xl font-semibold text-gray-700 dark:text-gray-200">
                    Notes ST LMD - Semestre 1
                </h1>
            </div>
            <!-- Optional: Add navigation or other elements here -->
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 max-w-7xl flex-grow py-8"> 
        <!-- This card wraps filters and table, initially hidden -->
        <div id="mainContentCard" class="main-content-card" data-aos="fade-up">
            <div class="filters-container">
              <h1 class="page-title">Consulter les Notes - Science et Technologie LMD</h1>
              <div class="filters-grid">
                <div class="filter-group">
                  <label for="sectionSelect" class="filter-label">Section:</label>
                  <select id="sectionSelect" class="filter-select">
                    <option value="">Toutes</option>
                    <option>A</option><option>B</option><option>C</option><option>D</option>
                    <option>E</option><option>F</option><option>G</option><option>H</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label for="groupSelect" class="filter-label">Groupe:</label>
                  <select id="groupSelect" class="filter-select">
                    <option value="">Tous</option>
                    <option>1</option><option>2</option><option>3</option><option>4</option>
                    <option>5</option><option>6</option><option>7</option><option>8</option>
                  </select>
                </div>
              </div>
              <div class="text-center mt-6">
                <a href="notes-science-technologie.html" class="back-button"> <!-- Changed href to a specific page if needed -->
                  <i class="fas fa-arrow-left"></i>
                  <span>Retour Sélection</span>
                </a>
              </div>
            </div>
            
            <div class="table-wrapper mt-6">
              <div class="table-scroll">
                <table id="marksTable">
                  <thead>
                    <tr>
                      <th class="name-column sticky-header">Nom et Prénom</th>
                      <th class="sticky-header">Matricule</th>
                      <th class="sticky-header">Groupe</th>
                      <th class="grade-column sticky-header sortable" onclick="sortTable('Maths 1')">
                        Maths 1 <span class="sort-indicator"></span>
                      </th>
                      <th class="grade-column sticky-header sortable" onclick="sortTable('Phys1')">
                        Phys1 <span class="sort-indicator"></span>
                      </th>
                      <th class="grade-column sticky-header sortable" onclick="sortTable('Chimie 1')">
                        Chimie 1 <span class="sort-indicator"></span>
                      </th>
                      <th class="grade-column sticky-header sortable" onclick="sortTable('Info 1')">
                        Info 1 <span class="sort-indicator"></span>
                      </th>
                      <th class="grade-column sticky-header sortable" onclick="sortTable('MR')">
                        MR <span class="sort-indicator"></span>
                      </th>
                      <th class="grade-column sticky-header sortable" onclick="sortTable('MST1')">
                        MST1 <span class="sort-indicator"></span>
                      </th>
                      <th class="grade-column sticky-header sortable" onclick="sortTable('DED')">
                        DED <span class="sort-indicator"></span>
                      </th>
                      <th class="grade-column sticky-header sortable" onclick="sortTable('Angl 1')">
                        Angl 1 <span class="sort-indicator"></span>
                      </th>
                      <th class="grade-column sticky-header">Moyenne Générale</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Table body will be populated by JavaScript -->
                     <tr><td colspan="12" class="text-center py-10 text-gray-500 dark:text-gray-400">Chargement des données...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
        </div> <!-- End main content card -->
    </main>

    <!-- Authentication Overlay -->
    <div id="loginOverlay" class="popup active"> 
      <div class="popup-content-wrapper">
        <h2>Authentification Requise</h2>
        <input type="password" id="passwordInput" placeholder="Entrez le mot de passe">
        <button onclick="checkPassword()">Se Connecter</button>
        <p id="loginError" class="login-error">Mot de passe incorrect.</p>
        <p class="auth-message">
          Si tu es un étudiant ST LMD, contacte l'admin de la page 
          <a href="https://www.instagram.com/spot_campuselkseur" target="_blank" class="instagram-link">@spot_campuselkseur</a> 
          sur Instagram pour obtenir le mot de passe.
        </p>
      </div>
    </div>

    <footer>
         © <span id="currentYear"></span> Université de Bejaia. Développé par 
         <a href="mailto:mehdi.amara@tech.univ-bejaia.dz">Amara Mehdi</a>
         <p class="text-xs mt-1">Initiative étudiante non officielle à des fins éducatives.</p>
     </footer>

    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
        <i class="fas fa-moon"></i>
    </button>
     <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>

    <script>
        AOS.init({ duration: 800, once: true, offset: 50 });
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        function toggleTheme() {
            const body = document.body;
            const themeToggleIcon = document.querySelector('.theme-toggle i');
            if (body.classList.contains('dark')) {
                body.classList.remove('dark');
                themeToggleIcon.classList.remove('fa-sun'); themeToggleIcon.classList.add('fa-moon');
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark');
                themeToggleIcon.classList.remove('fa-moon'); themeToggleIcon.classList.add('fa-sun');
                localStorage.setItem('theme', 'dark');
            }
        }

        // Create floating particles - adapted for ST page theme colors
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            if (!particlesContainer) return;
            const colors = ['hsl(var(--primary))', 'hsl(var(--success))', 'hsl(var(--warning))']; // Blue, Green, Yellow using CSS variables
            for (let i = 0; i < 30; i++) { // More particles for density
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                particle.style.left = `${Math.random() * 100}vw`; particle.style.top = `${Math.random() * 100}vh`;
                const size = Math.random() * 3 + 1; // Slightly larger particles
                particle.style.width = `${size}px`; particle.style.height = particle.style.width;
                particle.style.setProperty('--x', `${(Math.random() - 0.5) * 200}px`); // Wider movement range
                particle.style.setProperty('--y', `${(Math.random() - 0.5) * 200}px`);
                particle.style.animationDuration = `${Math.random() * 15 + 10}s`; // Slower animation
                particle.style.animationDelay = `${Math.random() * 5}s`; // Varied delays
                particlesContainer.appendChild(particle);
            }
        }
        
        function closePopup(popupId) { 
            const popup = document.getElementById(popupId);
            if (popup) {
                // popup.classList.remove('active'); // Keep the popup active until password is correct
                // Only hide if the password is correct
                 document.body.style.overflow = ''; // Re-enable scroll
            }
        }

        // --- Existing ST Marks JS (adapted for new styles and password) ---
        let marksData = [];
        let currentSort = { column: '', direction: 'asc' };

        function getBaseUrl() {
            const currentUrl = window.location.href;
             // Assuming the data is always relative to the repo root or local
             if (currentUrl.includes('github.io')) { return 'https://amarameh.github.io/moyensy.github.io/'; }
            return './'; // Default for local testing
        }

        async function loadData() {
            try {
                const fullUrl = `${getBaseUrl()}data/Marks.json`;
                console.log('Attempting to load data from:', fullUrl);
                // Using fetch with headers to prevent caching issues during development
                const response = await fetch(fullUrl, { headers: { 'Cache-Control': 'no-cache' }});
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}, URL: ${fullUrl}`);
                const data = await response.json();
                if (!Array.isArray(data)) throw new Error('Invalid data format: expected array');

                // Filter data if needed (original code had a filter, keeping it)
                marksData = data.filter(item => item.hasOwnProperty("N°") || item.hasOwnProperty("Angl 1")); 
                console.log('Filtered data:', marksData.length, 'records');
                
                // Render table with initial data (it will be hidden by the overlay)
                renderTable(marksData);

            } catch (error) {
                console.error('Error loading data:', error);
                const tbody = document.querySelector('#marksTable tbody');
                tbody.innerHTML = `<tr><td colspan="12" class="text-center py-4 text-red-600 dark:text-red-400"><i class="fas fa-exclamation-triangle mr-2"></i>Erreur chargement données: ${error.message}</td></tr>`;
            }
        }

        function applyFilters() {
          const section = document.getElementById('sectionSelect').value;
          const group = document.getElementById('groupSelect').value;
          let filtered = marksData.filter(item => {
            const rowGroup = item["Group"] || "";
            // Handle potential null/undefined for Group
            const matchesSection = section ? (rowGroup ? rowGroup.startsWith(section) : false) : true;
            const matchesGroup = group ? (rowGroup ? rowGroup.endsWith(group) : false) : true;
            return matchesSection && matchesGroup;
          });
          
          // Re-apply sort if active
          if (currentSort.column) {
            sortData(filtered, currentSort.column, currentSort.direction); 
          }
          renderTable(filtered);
        }
        
        function sortData(dataArray, column, direction) {
             dataArray.sort((a, b) => {
                // Safely get values, treat missing/NaN as a value that sorts predictably
                let aVal = a[column] !== undefined && a[column] !== null ? parseFloat(a[column].replace(',', '.')) : -Infinity; 
                let bVal = b[column] !== undefined && b[column] !== null ? parseFloat(b[column].replace(',', '.')) : -Infinity;

                // Handle non-numeric values if necessary, though marks should be numeric
                if (isNaN(aVal) && isNaN(bVal)) return 0; // Both non-numeric, treat as equal
                if (isNaN(aVal)) return direction === 'asc' ? 1 : -1; // a is non-numeric, b is numeric
                if (isNaN(bVal)) return direction === 'asc' ? -1 : 1; // b is non-numeric, a is numeric

                return direction === 'asc' ? aVal - bVal : bVal - aVal;
            });
        }

        function renderTable(data) {
          const tbody = document.querySelector('#marksTable tbody');
          tbody.innerHTML = ''; // Clear previous rows
          
          if (data.length === 0) {
              tbody.innerHTML = `<tr><td colspan="12" class="text-center py-10 text-gray-500 dark:text-gray-400">Aucun résultat trouvé pour ces filtres.</td></tr>`;
              return;
          }
          
          data.forEach(item => {
            const tr = document.createElement('tr');
            // Ensure 'N°', 'Nom', 'Prénom' are checked safely
            const isFounder = (item["N°"] == "942" || item["N°"] === 942) && (item["Nom"] || "").toUpperCase() === "AMARA" && (item["Prénom"] || "").toUpperCase() === "MEHDI";
            if (isFounder) { tr.classList.add('founder-row'); }
            
            // Use || "" to handle potentially missing fields gracefully, replace '.' with ',' for display
            tr.innerHTML = `
              <td class="name-cell">
                ${item["Nom"] || ""} ${item["Prénom"] || ""}
                ${isFounder ? '<span class="founder-badge">👑 Fondateur</span>' : ''}
              </td>
              <td class="text-cell">${item["Matricule"] || ""}</td>
              <td class="text-cell">${item["Group"] || ""}</td>
              <td class="grade-cell ${colorMark(item["Maths 1"])}">${formatMark(item["Maths 1"])}</td>
              <td class="grade-cell ${colorMark(item["Phys1"])}">${formatMark(item["Phys1"])}</td>
              <td class="grade-cell ${colorMark(item["Chimie 1"])}">${formatMark(item["Chimie 1"])}</td>
              <td class="grade-cell ${colorMark(item["Info 1"])}">${formatMark(item["Info 1"])}</td>
              <td class="grade-cell ${colorMark(item["MR"])}">${formatMark(item["MR"])}</td>
              <td class="grade-cell ${colorMark(item["MST1"])}">${formatMark(item["MST1"])}</td>
              <td class="grade-cell ${colorMark(item["DED"])}">${formatMark(item["DED"])}</td>
              <td class="grade-cell ${colorMark(item["Angl 1"])}">${formatMark(item["Angl 1"])}</td>
              <!-- Moyenne Générale - Calculate if possible -->
              <td class="grade-cell ${colorMark(calculateMoyenne(item))}">${formatMark(calculateMoyenne(item))}</td>
            `;
            tbody.appendChild(tr);
          });
        }
         
         function formatMark(mark) {
            if (mark === undefined || mark === null || mark === "") return "";
            const num = parseFloat(String(mark).replace(',', '.'));
            if (isNaN(num)) return String(mark); // Return original if not a number
            return num.toFixed(2).replace('.', ','); // Format to 2 decimal places, use comma
         }

        function colorMark(mark) {
          const num = parseFloat(String(mark).replace(',', '.'));
          if (isNaN(num)) return 'text-gray-400 dark:text-gray-500'; // Style for missing marks
          return num < 10 ? 'grade-failing' : 'grade-passing';
        }

        // Function to calculate general average
        function calculateMoyenne(item) {
            const modules = ['Maths 1', 'Phys1', 'Chimie 1', 'Info 1', 'MR', 'MST1', 'DED', 'Angl 1'];
            let totalPoints = 0;
            let totalCredits = 0; // Assuming 1 credit per module for simplicity or adjust as needed

            // Example credits (adjust based on actual curriculum if known)
            // Using a simplified 1 credit per module assumption as data doesn't include credits
            const credits = { 
                'Maths 1': 1, 'Phys1': 1, 'Chimie 1': 1, 'Info 1': 1, 
                'MR': 1, 'MST1': 1, 'DED': 1, 'Angl 1': 1
            };

            modules.forEach(module => {
                const mark = parseFloat(String(item[module]).replace(',', '.'));
                if (!isNaN(mark) && mark >= 0) { // Include non-zero marks
                    const moduleCredits = credits[module] || 0;
                    totalPoints += mark * moduleCredits;
                    totalCredits += moduleCredits;
                }
            });

            if (totalCredits === 0) return "N/A"; // Avoid division by zero
            const moyenne = totalPoints / totalCredits;
             // Check if the student passed the semester (assuming 10 average)
            // This is a simplification, actual validation rules might be different
            return moyenne; // Return the calculated average
        }


        function sortTable(column) {
          // Allow sorting on module columns and Moyenne Générale if calculated
          const sortableColumns = ['Maths 1', 'Phys1', 'Chimie 1', 'Info 1', 'MR', 'MST1', 'DED', 'Angl 1', 'Moyenne Générale']; 
          if (!sortableColumns.includes(column)) return;

          if (currentSort.column === column) {
            currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
          } else {
            currentSort.column = column;
            currentSort.direction = 'asc';
          }

          // Get currently filtered data to sort
          const section = document.getElementById('sectionSelect').value;
          const group = document.getElementById('groupSelect').value;
          let dataToSort = marksData.filter(item => {
             const rowGroup = item["Group"] || "";
             const matchesSection = section ? (rowGroup ? rowGroup.startsWith(section) : false) : true;
             const matchesGroup = group ? (rowGroup ? rowGroup.endsWith(group) : false) : true;
             return matchesSection && matchesGroup;
           });

           // Custom sort for Moyenne Générale
           if (column === 'Moyenne Générale') {
                dataToSort.sort((a, b) => {
                    let aMoy = calculateMoyenne(a);
                    let bMoy = calculateMoyenne(b);

                    // Treat "N/A" as a value that sorts to the bottom
                    if (aMoy === "N/A" && bMoy === "N/A") return 0;
                    if (aMoy === "N/A") return direction === 'asc' ? 1 : -1;
                    if (bMoy === "N/A") return direction === 'asc' ? -1 : 1;

                    return direction === 'asc' ? aMoy - bMoy : bMoy - aMoy;
                });
           } else {
                sortData(dataToSort, column, currentSort.direction); // Use existing sortData for modules
           }

          updateSortIndicators(column);
          renderTable(dataToSort); // Render the sorted filtered data
        }

        function updateSortIndicators(column) {
          // Remove indicators from all sortable headers
          document.querySelectorAll('#marksTable th.sortable').forEach(th => {
            const indicator = th.querySelector('.sort-indicator');
             if (indicator) { // Check if indicator exists
                indicator.classList.remove('sort-asc', 'sort-desc');
             }
          });
          
          // Add indicator to the currently sorted column
          const th = document.querySelector(`th[onclick*="sortTable('${column}')"]`); // Use * to find the right th
          if (th) {
            const indicator = th.querySelector('.sort-indicator');
             if (indicator) { // Check if indicator exists
                indicator.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');
             }
          }
        }

        function goBack() {
            // Go back to the general notes selection page
            window.location.href = 'notes-science-technologie.html'; 
        }

        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            const errorMsg = document.getElementById('loginError');
            const correctPassword = 'Hachak2025'; // New Password
            
            if (input === correctPassword) {
                // Password is correct, close the overlay and show the content
                const loginOverlay = document.getElementById('loginOverlay');
                loginOverlay.classList.remove('active'); 
                document.getElementById('mainContentCard').style.visibility = 'visible'; // Show main content
                document.body.style.overflow = ''; // Re-enable scrolling
                
                // Optional: Add a small animation to the main content card after showing
                AOS.refresh(); // Make sure AOS picks up the now visible card
            } else {
                errorMsg.style.display = 'block';
                // Add shake animation to input on error
                const passInput = document.getElementById('passwordInput');
                passInput.classList.add('animate-shake'); 
                setTimeout(() => {
                    errorMsg.style.display = 'none';
                    passInput.classList.remove('animate-shake');
                }, 1000); // Reduced timeout for faster feedback
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark');
                document.querySelector('.theme-toggle i').classList.replace('fa-moon', 'fa-sun');
            }
            createParticles();
            loadData(); // Load data but content card remains hidden until login

            // Add filter listeners
             document.getElementById('sectionSelect').addEventListener('change', applyFilters);
             document.getElementById('groupSelect').addEventListener('change', applyFilters);

            // Add keypress listener for Enter key on password input
            const passwordInput = document.getElementById('passwordInput');
            if(passwordInput) {
                passwordInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault(); // Prevent default form submission (if any)
                        checkPassword();
                    }
                });
            }

             // Lock body scroll when popup is active
             const loginOverlay = document.getElementById('loginOverlay');
             if(loginOverlay.classList.contains('active')) {
                 document.body.style.overflow = 'hidden';
             }
        });

    </script>
</body>
</html>