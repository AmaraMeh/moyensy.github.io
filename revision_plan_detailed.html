<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mon Plan de Révision - E-Campus Platform</title>
    <meta name="description" content="Plan de révision personnalisé pour les examens de 1ère Année Technologie à l'Université de Bejaia - Campus El-Kseur.">
    <meta name="author" content="Amara Mehdi">
    <link rel="icon" type="image/png" href="assets/img/icon.png">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <style>
        /* Base Variables */
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --primary: 221.2 83.2% 53.3%; /* Bright Blue */
            --primary-foreground: 210 40% 98%; /* Off White */
            --secondary: 210 40% 96.1%; /* Light Gray */
            --secondary-foreground: 222.2 47.4% 11.2%; /* Dark Blue */
            --muted: 210 40% 96.1%; /* Light Gray (same as secondary) */
            --muted-foreground: 215.4 16.3% 46.9%; /* Muted Gray */
            --accent: 210 40% 96.1%; /* Light Gray (same as secondary) */
            --accent-foreground: 222.2 47.4% 11.2%; /* Dark Blue (same as secondary-foreground) */
            --border: 214.3 31.8% 91.4%; /* Light Border Gray */
            --input: 214.3 31.8% 91.4%; /* Light Input Border Gray */
            --ring: 221.2 83.2% 53.3%; /* Bright Blue (same as primary) */
            --radius: 0.5rem;

            /* Priority Colors */
            --priority-1: 38 92% 50%; /* Yellow/Orange */
            --priority-2: 221.2 83.2% 53.3%; /* Blue (same as primary) */
            --priority-3: 142.1 76.2% 36.3%; /* Green */

             /* Other Specific Colors */
             --exam-red: 350 80% 50%; /* Red */
             --exam-red-light: 350 80% 95%; /* Very Light Red */
             --exam-red-dark: 350 80% 30%; /* Darker Red */
             --passed-color: 210 10% 70%; /* Gray for passed items */
        }

        /* Dark Mode Variables */
        .dark {
            --background: 222.2 84% 4.9%; /* Dark Background */
            --foreground: 210 40% 98%; /* Light Foreground */
            --card: 222.2 84% 4.9%; /* Dark Card (same as background) */
            --card-foreground: 210 40% 98%; /* Light Card Foreground (same as foreground) */
            --primary: 217.2 91.2% 59.8%; /* Lighter Blue */
            --primary-foreground: 222.2 47.4% 11.2%; /* Dark Blue (same as secondary-foreground light mode) */
            --secondary: 217.2 32.6% 17.5%; /* Darker Secondary */
            --secondary-foreground: 210 40% 98%; /* Light Secondary Foreground (same as foreground) */
            --muted: 217.2 32.6% 17.5%; /* Darker Muted (same as secondary dark) */
            --muted-foreground: 215 20.2% 65.1%; /* Lighter Muted Gray */
            --accent: 217.2 32.6% 17.5%; /* Darker Accent (same as secondary dark) */
            --accent-foreground: 210 40% 98%; /* Light Accent Foreground (same as foreground) */
            --border: 217.2 32.6% 17.5%; /* Dark Border */
            --input: 217.2 32.6% 17.5%; /* Dark Input Border */
            --ring: 224.3 76.3% 48%; /* Slightly different Ring */

             /* Priority Colors - Dark mode adjustments */
             --priority-1: 48 96% 64%; /* Brighter Yellow */
             --priority-2: 217.2 91.2% 59.8%; /* Lighter Blue (same as primary dark) */
             --priority-3: 149.1 68.3% 48.3%; /* Brighter Green */

              /* Other Specific Colors */
             --exam-red: 0 80% 60%; /* Slightly different Red */
             --exam-red-light: 0 80% 15%; /* Dark Red Background */
             --exam-red-dark: 0 80% 80%; /* Light Red Text */
             --passed-color: 210 10% 40%; /* Darker Gray for passed */
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: hsl(var(--background));
            color: hsl(var(--foreground));
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            position: relative;
            overflow-x: hidden; /* Prevent horizontal scroll initially */
        }
         /* Smooth transition for all relevant properties */
         .theme-transition,
         .theme-transition *,
         .theme-transition *::before,
         .theme-transition *::after {
             transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, box-shadow, opacity, transform;
             transition-duration: 0.5s; /* Smoother transition */
             transition-timing-function: ease-in-out;
         }
         /* Exclude elements managed by specific animations or libraries like AOS */
         .theme-transition *:not(.floating-dot, .particle, .gradient-blob, [data-aos], [data-aos] *),
         .theme-transition *::before:not([data-aos]),
         .theme-transition *::after:not([data-aos]) {
              transition-property: all;
              transition-duration: 0.5s;
              transition-timing-function: ease-in-out;
         }


        /* Background Elements */
        .hero-bg {
            position: fixed; /* Use fixed for better scrolling experience */
            inset: 0;
            z-index: -10;
            overflow: hidden;
            pointer-events: none;
            filter: saturate(0.9);
            opacity: 0.8;
        }

        .gradient-blob {
            position: absolute;
            border-radius: 9999px;
            filter: blur(80px);
            opacity: 0.3;
            pointer-events: none;
            animation: blob-float 15s infinite ease-in-out alternate;
        }

        .gradient-blob-1 {
            top: -20%; left: -20%; width: 700px; height: 700px;
            background: linear-gradient(to bottom right, hsl(var(--primary) / 0.6), hsl(var(--ring) / 0.4), hsl(var(--accent) / 0.2));
            animation-delay: 0s;
        }

        .gradient-blob-2 {
            bottom: -20%; right: -20%; width: 700px; height: 700px;
            background: linear-gradient(to top left, hsl(var(--ring) / 0.5), hsl(var(--accent) / 0.4), transparent);
            animation-delay: 5s;
        }

        @keyframes blob-float {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(20px, 30px) scale(1.05); }
        }

        .floating-dot {
            position: absolute;
            border-radius: 9999px;
            animation: pulse-dot 2s infinite ease-in-out alternate;
            pointer-events: none;
            opacity: 0.6;
            box-shadow: 0 0 8px rgba(0,0,0,0.1);
        }
        @keyframes pulse-dot {
            0%, 100% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.1); opacity: 0.9; }
        }

         /* Specific dot colors */
         .dot-primary { background-color: hsl(var(--primary)); }
         .dot-ring { background-color: hsl(var(--ring)); }
         .dot-p1 { background-color: hsl(var(--priority-1)); }
         .dot-p2 { background-color: hsl(var(--priority-2)); }
         .dot-p3 { background-color: hsl(var(--priority-3)); }
         .dot-muted { background-color: hsl(var(--muted-foreground)); }


        /* Floating Particles */
         .floating-particles {
            position: fixed; /* Use fixed */
            inset: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: -5;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.7;
            animation: float 12s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% {
                transform: translate(0, 0) scale(1);
                opacity: 0.3;
            }
            50% {
                transform: translate(var(--x), var(--y)) scale(1.2);
                opacity: 0.8;
            }
        }


        /* Theme Toggle & View Toggle */
        .utility-buttons {
             position: fixed;
             bottom: 1rem;
             right: 1rem;
             z-index: 50;
             display: flex;
             flex-direction: column;
             gap: 0.5rem;
             align-items: flex-end;
        }
        .utility-buttons button {
            width: 3rem;
            height: 3rem;
            border-radius: 9999px;
            background: hsl(var(--background) / 0.8);
            backdrop-filter: blur(8px);
            border: 1px solid hsl(var(--border));
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .utility-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .utility-buttons button i {
            font-size: 1.25rem;
            color: hsl(var(--primary));
             transition: color 0.3s ease;
        }
         .utility-buttons button i.fa-table,
         .utility-buttons button i.fa-list {
              font-size: 1.1rem; /* Slightly smaller icon */
         }

        /* Specific Styles for Vertical Timeline */
        #timeline-view .timeline {
            position: relative;
            padding: 20px 0;
             margin-top: 40px;
        }

        #timeline-view .timeline::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 3px;
            background: hsl(var(--border));
            margin-left: -1.5px;
            transition: background-color 0.3s ease;
        }

         .dark #timeline-view .timeline::before {
             background: hsl(var(--border));
         }

        #timeline-view .timeline-item {
            margin-bottom: 25px;
            position: relative;
             transition: transform 0.3s ease, opacity 0.3s ease;
        }

        #timeline-view .timeline-item::after {
            content: '';
            display: table;
            clear: both;
        }

        #timeline-view .timeline-date {
            position: absolute;
            top: 0;
            width: 100%;
            text-align: center;
            transform: translateY(-50%);
            z-index: 10;
             pointer-events: none;
        }

        #timeline-view .timeline-date h3 {
            display: inline-flex;
            align-items: center;
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            min-width: 160px;
            justify-content: center;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        #timeline-view .timeline-date i {
            margin-right: 8px;
        }


        #timeline-view .timeline-content {
            position: relative;
            width: calc(50% - 25px);
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            padding: 18px;
            background: hsl(var(--card));
            box-shadow: 0 4px 10px rgba(0,0,0,0.06);
            transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
            display: flex;
            flex-direction: column;
            min-height: 100px;
        }

        #timeline-view .timeline-content:hover {
            transform: translateY(-4px);
            border-color: hsl(var(--primary));
            box-shadow: 0 8px 18px rgba(0,0,0,0.1);
        }

        #timeline-view .timeline-item:nth-child(odd) .timeline-content {
            float: left;
            clear: left;
        }

        #timeline-view .timeline-item:nth-child(even) .timeline-content {
            float: right;
            clear: right;
        }

         #timeline-view .timeline-timespan {
             font-size: 0.85rem;
             color: hsl(var(--muted-foreground));
             margin-bottom: 6px;
             display: block;
         }

        #timeline-view .timeline-marker {
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: hsl(var(--primary));
            z-index: 1;
            top: 22px;
            margin-top: -7px;
            transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 0 0 0px hsl(var(--primary) / 0.5);
        }

        /* Marker positioning */
        #timeline-view .timeline-item:nth-child(odd) .timeline-marker {
            left: 50%;
            margin-left: -7px;
            transform: translateX(-calc(100% + 18px));
        }

        #timeline-view .timeline-item:nth-child(even) .timeline-marker {
            left: 50%;
            margin-left: -7px;
            transform: translateX(calc(100% + 18px));
        }

        #timeline-view .timeline-content h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
             align-items: center;
             color: hsl(var(--foreground));
        }

        #timeline-view .timeline-content p {
            font-size: 0.95rem;
            color: hsl(var(--muted-foreground));
             flex-grow: 1;
        }

        /* Different content types */
        #timeline-view .study-session {
             background: linear-gradient(to right, hsl(var(--primary) / 0.04), transparent);
             border-left: 3px solid hsl(var(--primary));
             padding-left: 15px;
             transition: all 0.3s ease;
        }
         .dark #timeline-view .study-session {
             background: linear-gradient(to right, hsl(var(--primary) / 0.1), transparent);
         }
        #timeline-view .study-session .timeline-marker {
             background: hsl(var(--primary));
             box-shadow: 0 0 0 5px hsl(var(--primary) / 0.2);
        }

         /* Priority coloring for titles */
         #timeline-view .study-session h4 .priority-tag {
             font-size: 0.75rem;
             font-weight: 500;
             margin-left: auto;
             padding: 1px 7px;
             border-radius: 12px;
             background-color: hsl(var(--muted));
             color: hsl(var(--muted-foreground));
             white-space: nowrap;
         }
         .dark #timeline-view .study-session h4 .priority-tag {
              background-color: hsl(var(--secondary));
              color: hsl(var(--secondary-foreground));
         }

         #timeline-view .study-session h4 .priority-tag.p1 { background-color: hsl(var(--priority-1) / 0.2); color: hsl(var(--priority-1)); }
         .dark #timeline-view .study-session h4 .priority-tag.p1 { background-color: hsl(var(--priority-1) / 0.3); color: hsl(var(--priority-1)); }

         #timeline-view .study-session h4 .priority-tag.p2 { background-color: hsl(var(--priority-2) / 0.2); color: hsl(var(--priority-2)); }
         .dark #timeline-view .study-session h4 .priority-tag.p2 { background-color: hsl(var(--priority-2) / 0.3); color: hsl(var(--priority-2)); }

         #timeline-view .study-session h4 .priority-tag.p3 { background-color: hsl(var(--priority-3) / 0.2); color: hsl(var(--priority-3)); }
         .dark #timeline-view .study-session h4 .priority-tag.p3 { background-color: hsl(var(--priority-3) / 0.3); color: hsl(var(--priority-3)); }


        #timeline-view .break-time, #timeline-view .free-time {
            background: hsl(var(--secondary) / 0.7);
            color: hsl(var(--secondary-foreground));
            border-left: 3px solid hsl(var(--muted));
            padding-left: 15px;
        }
        .dark #timeline-view .break-time, .dark #timeline-view .free-time {
            background: hsl(var(--secondary));
        }

        #timeline-view .break-time .timeline-marker, #timeline-view .free-time .timeline-marker {
            background: hsl(var(--muted-foreground));
            box-shadow: none;
        }
        #timeline-view .break-time h4, #timeline-view .free-time h4 {
             color: hsl(var(--secondary-foreground));
        }
         .dark #timeline-view .break-time h4, .dark #timeline-view .free-time h4 {
             color: hsl(var(--foreground));
         }


        /* Exam event styling */
        #timeline-view .exam-event .timeline-marker {
            background-color: hsl(var(--exam-red));
             box-shadow: 0 0 0 8px hsl(var(--exam-red) / 0.3);
        }
        #timeline-view .exam-event .timeline-content {
             border-left-color: hsl(var(--exam-red));
             background: hsl(var(--exam-red-light));
             color: hsl(var(--foreground));
        }
         .dark #timeline-view .exam-event .timeline-content {
             background: hsl(var(--exam-red-light));
         }
        #timeline-view .exam-event h4 {
             color: hsl(var(--exam-red-dark));
        }
         .dark #timeline-view .exam-event h4 {
             color: hsl(var(--exam-red-dark));
         }

        /* Highlighting (Timeline View) */
        #timeline-view .current-day .timeline-date h3 {
            background: hsl(var(--ring));
            color: hsl(var(--primary-foreground));
             animation: pulse-bg 1.5s infinite alternate;
             box-shadow: 0 4px 10px hsl(var(--ring) / 0.3);
        }

         #timeline-view .current-session .timeline-content {
             border-color: hsl(var(--ring));
             background: linear-gradient(to right, hsl(var(--ring) / 0.1), transparent);
             box-shadow: 0 6px 15px rgba(0,0,0,0.15);
             transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
         }
         .dark #timeline-view .current-session .timeline-content {
             background: linear-gradient(to right, hsl(var(--ring) / 0.2), transparent);
         }
          #timeline-view .current-session .timeline-marker {
             background: hsl(var(--ring));
             animation: pulse-marker 1.5s infinite alternate;
             box-shadow: 0 0 0 8px hsl(var(--ring) / 0.3);
          }

         /* Keyframes for highlighting (Timeline View) */
         @keyframes pulse-bg {
            0% { background: hsl(var(--primary)); }
            100% { background: hsl(var(--ring)); }
         }
          @keyframes pulse-marker {
            0% { transform: scale(1) var(--marker-translate, translateX(0)); opacity: 1; box-shadow: 0 0 0 0px hsl(var(--ring) / 0.3); }
            50% { transform: scale(1.3) var(--marker-translate, translateX(0)); opacity: 1; box-shadow: 0 0 0 8px hsl(var(--ring) / 0.5); }
            100% { transform: scale(1) var(--marker-translate, translateX(0)); opacity: 1; box-shadow: 0 0 0 0px hsl(var(--ring) / 0.3); }
         }
         /* Apply correct transform for pulse animation */
         #timeline-view .timeline-item:nth-child(odd).current-session .timeline-marker { --marker-translate: translateX(-calc(100% + 18px)); }
         #timeline-view .timeline-item:nth-child(even).current-session .timeline-marker { --marker-translate: translateX(calc(100% + 18px)); }


        /* Passed sessions styling (Timeline View) */
         #timeline-view .passed .timeline-content {
            opacity: 0.6;
            background: hsl(var(--background) / 0.8);
             border-color: hsl(var(--border));
             box-shadow: none;
             transition: opacity 0.5s ease, background 0.3s ease;
         }
          .dark #timeline-view .passed .timeline-content {
             background: hsl(var(--background) / 0.5);
         }
         #timeline-view .passed .timeline-content:hover {
             transform: none;
             box-shadow: none;
             border-color: hsl(var(--border));
         }
          #timeline-view .passed .timeline-content h4,
          #timeline-view .passed .timeline-content p,
          #timeline-view .passed .timeline-timespan,
          #timeline-view .passed .task-checkbox label {
              color: hsl(var(--muted-foreground) / 0.7);
          }
           .dark #timeline-view .passed .timeline-content h4,
          .dark #timeline-view .passed .timeline-content p,
           .dark #timeline-view .passed .timeline-timespan,
           .dark #timeline-view .passed .task-checkbox label {
              color: hsl(var(--muted-foreground) / 0.6);
          }
          #timeline-view .passed .timeline-marker {
             background: hsl(var(--passed-color));
             box-shadow: none;
          }
         #timeline-view .passed .task-checkbox input {
             accent-color: hsl(var(--passed-color));
         }


          /* Task completion checkbox (Timeline View) */
        #timeline-view .task-checkbox {
            margin-top: 10px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: hsl(var(--muted-foreground));
             cursor: pointer;
        }
        #timeline-view .task-checkbox input {
            margin-right: 8px;
             accent-color: hsl(var(--primary));
             cursor: pointer;
        }
        #timeline-view .completed .timeline-content {
            opacity: 0.7;
            background: hsl(var(--secondary) / 0.6);
             border-color: hsl(var(--muted));
             box-shadow: none;
             transition: opacity 0.3s ease, background 0.3s ease;
        }
         .dark #timeline-view .completed .timeline-content {
             background: hsl(var(--secondary) / 0.6);
         }
         #timeline-view .completed .timeline-content:hover {
             transform: none;
             box-shadow: none;
             border-color: hsl(var(--muted));
         }
         #timeline-view .completed .timeline-content h4,
         #timeline-view .completed .timeline-content p,
          #timeline-view .completed .timeline-timespan,
           #timeline-view .completed .task-checkbox label {
             text-decoration: line-through;
             color: hsl(var(--muted-foreground) / 0.8);
         }
          .dark #timeline-view .completed .timeline-content h4,
         .dark #timeline-view .completed .timeline-content p,
          .dark #timeline-view .completed .timeline-timespan,
          .dark #timeline-view .completed .task-checkbox label {
             color: hsl(var(--muted-foreground) / 0.8);
         }
         #timeline-view .completed .timeline-marker {
             background: hsl(var(--muted-foreground));
             box-shadow: none;
         }
         #timeline-view .completed .task-checkbox input {
             accent-color: hsl(var(--muted-foreground));
         }

         /* Media Queries for Timeline View */
        @media (max-width: 768px) {
            #timeline-view .timeline::before {
                left: 20px;
                margin-left: 0;
                width: 2px;
            }

            #timeline-view .timeline-item {
                margin-bottom: 30px;
            }

            #timeline-view .timeline-date {
                text-align: left;
                position: relative;
                top: 0;
                left: 0;
                transform: none;
                margin-bottom: 10px;
                z-index: 5;
                width: auto;
            }

            #timeline-view .timeline-date h3 {
                transform: none;
                font-size: 0.9rem;
                min-width: auto;
                padding: 4px 12px;
                display: inline-flex;
                margin-left: 30px;
            }

            #timeline-view .timeline-date i {
                margin-right: 6px;
            }

            #timeline-view .timeline-content {
                width: calc(100% - 50px);
                float: right;
                margin-left: 50px;
                padding: 15px;
                min-height: auto;
            }

            #timeline-view .timeline-item:nth-child(odd) .timeline-content,
            #timeline-view .timeline-item:nth-child(even) .timeline-content {
                float: right;
                clear: right;
            }

            #timeline-view .timeline-marker {
                left: 20px;
                margin-left: 0;
                transform: translateX(0);
                top: 50%;
                margin-top: -7px;
                width: 12px;
                height: 12px;
            }

            #timeline-view .timeline-item:nth-child(odd) .timeline-marker,
            #timeline-view .timeline-item:nth-child(even) .timeline-marker {
                left: 20px;
                margin-left: 0;
                transform: translateX(0);
            }

            #timeline-view .timeline-content h4 {
                font-size: 1rem;
                margin-bottom: 3px;
            }

            #timeline-view .timeline-content p {
                font-size: 0.85rem;
            }

            #timeline-view .timeline-timespan {
                font-size: 0.8rem;
                margin-bottom: 4px;
            }

            #timeline-view .study-session h4 .priority-tag {
                font-size: 0.7rem;
                padding: 0 5px;
            }

             /* Mobile adjustment for pulse marker */
             #timeline-view .current-session .timeline-marker { animation: pulse-marker-mobile 1.5s infinite alternate; }
              @keyframes pulse-marker-mobile {
                   0% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0px hsl(var(--ring) / 0.3); }
                   50% { transform: scale(1.3); opacity: 1; box-shadow: 0 0 0 8px hsl(var(--ring) / 0.5); }
                   100% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0px hsl(var(--ring) / 0.3); }
              }
        }


        /* Styles for Horizontal Timetable View */
        #table-view {
            display: none; /* Hidden by default */
            overflow-x: auto; /* Enable horizontal scrolling */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            margin-top: 40px;
             padding-bottom: 20px; /* Add space for scrollbar */
        }

        #table-view::-webkit-scrollbar {
            height: 8px;
        }

        #table-view::-webkit-scrollbar-track {
            background: hsl(var(--secondary));
            border-radius: 10px;
        }

        #table-view::-webkit-scrollbar-thumb {
            background: hsl(var(--primary));
            border-radius: 10px;
        }

        #table-view::-webkit-scrollbar-thumb:hover {
            background: hsl(var(--ring));
        }


        #table-view .timetable-container {
            display: flex;
            width: max-content; /* Allow content to define width */
            padding-top: 10px; /* Space for sticky header */
        }

        #table-view .day-column {
            min-width: 250px; /* Minimum width for each day */
            width: 250px; /* Fixed width for consistency */
            flex-shrink: 0; /* Prevent shrinking */
            margin-right: 10px; /* Space between columns */
             border: 1px solid hsl(var(--border));
             border-radius: var(--radius);
             background: hsl(var(--card));
             box-shadow: 0 4px 10px rgba(0,0,0,0.06);
             overflow: hidden; /* Keep content within border radius */
             position: relative; /* Needed for sticky items */
        }

         #table-view .day-column:last-child {
             margin-right: 0;
         }

         #table-view .day-header {
             background: hsl(var(--primary));
             color: hsl(var(--primary-foreground));
             padding: 10px 15px;
             font-weight: 600;
             text-align: center;
             font-size: 1rem;
             position: sticky;
             top: 0; /* Stick to the top of the column */
             z-index: 10;
             display: flex;
             align-items: center;
             justify-content: center;
             gap: 8px;
             transition: background-color 0.3s ease, color 0.3s ease;
         }

         #table-view .day-content {
             padding: 15px;
             display: flex;
             flex-direction: column;
             gap: 15px; /* Space between items within a day */
         }

         #table-view .timetable-item {
             border: 1px solid hsl(var(--border));
             border-radius: var(--radius);
             padding: 12px;
             background: hsl(var(--background));
             box-shadow: 0 2px 5px rgba(0,0,0,0.05);
             display: flex;
             flex-direction: column;
             transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, opacity 0.3s ease;
             min-height: 80px;
             position: relative; /* For highlight border */
         }
          #table-view .timetable-item::before {
              content: '';
              position: absolute;
              top: 0;
              left: 0;
              bottom: 0;
              width: 4px;
              background: transparent; /* Default */
              border-radius: var(--radius) 0 0 var(--radius);
              transition: background-color 0.3s ease;
          }


          #table-view .timetable-item:hover {
              transform: translateY(-3px);
              box-shadow: 0 4px 8px rgba(0,0,0,0.1);
              border-color: hsl(var(--primary));
          }
          #table-view .timetable-item:hover::before {
              background: hsl(var(--primary));
          }


         #table-view .item-timespan {
             font-size: 0.8rem;
             color: hsl(var(--muted-foreground));
             margin-bottom: 4px;
             display: block;
         }
         #table-view .item-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 4px;
             color: hsl(var(--foreground));
             display: flex;
             align-items: center;
             gap: 5px;
         }
         #table-view .item-title i {
             font-size: 0.9rem;
             color: hsl(var(--primary));
         }
         #table-view .item-description {
             font-size: 0.85rem;
             color: hsl(var(--muted-foreground));
             flex-grow: 1; /* Push checkbox down */
         }

          /* Item Type Specific Styles (Horizontal View) */
         #table-view .study-session::before {
             background: hsl(var(--primary));
         }
          #table-view .study-session:hover::before {
             background: hsl(var(--primary));
         }
          #table-view .study-session .priority-tag {
              font-size: 0.7rem;
              font-weight: 500;
              margin-left: auto;
              padding: 0 6px;
              border-radius: 10px;
              background-color: hsl(var(--muted));
              color: hsl(var(--muted-foreground));
              white-space: nowrap;
          }
           .dark #table-view .study-session .priority-tag {
              background-color: hsl(var(--secondary));
              color: hsl(var(--secondary-foreground));
           }
          #table-view .study-session .priority-tag.p1 { background-color: hsl(var(--priority-1) / 0.2); color: hsl(var(--priority-1)); }
          .dark #table-view .study-session .priority-tag.p1 { background-color: hsl(var(--priority-1) / 0.3); color: hsl(var(--priority-1)); }
          #table-view .study-session .priority-tag.p2 { background-color: hsl(var(--priority-2) / 0.2); color: hsl(var(--priority-2)); }
          .dark #table-view .study-session .priority-tag.p2 { background-color: hsl(var(--priority-2) / 0.3); color: hsl(var(--priority-2)); }
          #table-view .study-session .priority-tag.p3 { background-color: hsl(var(--priority-3) / 0.2); color: hsl(var(--priority-3)); }
          .dark #table-view .study-session .priority-tag.p3 { background-color: hsl(var(--priority-3) / 0.3); color: hsl(var(--priority-3)); }


          #table-view .break-time, #table-view .free-time {
              background: hsl(var(--secondary) / 0.7);
              color: hsl(var(--secondary-foreground));
          }
          .dark #table-view .break-time, .dark #table-view .free-time {
              background: hsl(var(--secondary));
          }
           #table-view .break-time::before, #table-view .free-time::before {
               background: hsl(var(--muted-foreground));
           }
            #table-view .break-time:hover::before, #table-view .free-time:hover::before {
               background: hsl(var(--primary)); /* Still highlight on hover */
           }
          #table-view .break-time .item-title, #table-view .free-time .item-title {
               color: hsl(var(--secondary-foreground));
          }
          .dark #table-view .break-time .item-title, .dark #table-view .free-time .item-title {
               color: hsl(var(--foreground));
           }


         #table-view .exam-event {
             background: hsl(var(--exam-red-light));
             color: hsl(var(--foreground));
         }
         .dark #table-view .exam-event {
             background: hsl(var(--exam-red-light));
         }
          #table-view .exam-event::before {
              background-color: hsl(var(--exam-red));
          }
           #table-view .exam-event:hover::before {
              background-color: hsl(var(--exam-red));
           }
         #table-view .exam-event .item-title {
              color: hsl(var(--exam-red-dark));
         }
         .dark #table-view .exam-event .item-title {
              color: hsl(var(--exam-red-dark));
         }
          #table-view .exam-event .item-title i {
              color: hsl(var(--exam-red-dark));
          }


        /* Highlighting (Horizontal View) */
        #table-view .current-day .day-header {
            background: hsl(var(--ring));
            color: hsl(var(--primary-foreground));
             animation: pulse-bg-horizontal 1.5s infinite alternate;
             box-shadow: 0 4px 10px hsl(var(--ring) / 0.3);
        }
         @keyframes pulse-bg-horizontal {
            0% { background: hsl(var(--primary)); }
            100% { background: hsl(var(--ring)); }
         }


        #table-view .current-session {
            border-color: hsl(var(--ring));
             background: linear-gradient(to right, hsl(var(--ring) / 0.1), transparent);
             box-shadow: 0 4px 8px rgba(0,0,0,0.1);
             transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
        }
         .dark #table-view .current-session {
             background: linear-gradient(to right, hsl(var(--ring) / 0.2), transparent);
         }
         #table-view .current-session::before {
             background: hsl(var(--ring));
             animation: pulse-border 1.5s infinite alternate;
         }
          @keyframes pulse-border {
            0%, 100% { background: hsl(var(--ring)); box-shadow: none; }
            50% { box-shadow: 0 0 8px hsl(var(--ring) / 0.5); }
          }

          #table-view .current-session:hover {
              border-color: hsl(var(--ring));
              box-shadow: 0 6px 12px rgba(0,0,0,0.15);
          }
          #table-view .current-session:hover::before {
               background: hsl(var(--ring));
               animation: none; /* Stop pulse on hover for clarity */
               box-shadow: none;
          }


         /* Passed items styling (Horizontal View) */
         #table-view .passed {
            opacity: 0.6;
            background: hsl(var(--background) / 0.8);
             border-color: hsl(var(--border));
             box-shadow: none;
             transition: opacity 0.5s ease, background 0.3s ease;
         }
          .dark #table-view .passed {
             background: hsl(var(--background) / 0.5);
         }
         #table-view .passed:hover {
             transform: none;
             box-shadow: none;
             border-color: hsl(var(--border));
         }
          #table-view .passed::before {
             background: hsl(var(--passed-color));
          }
           #table-view .passed:hover::before {
               background: hsl(var(--primary)); /* Still highlight on hover */
           }

          #table-view .passed .item-title,
          #table-view .passed .item-description,
          #table-view .passed .item-timespan,
          #table-view .passed .task-checkbox label {
              color: hsl(var(--muted-foreground) / 0.7);
          }
           .dark #table-view .passed .item-title,
          .dark #table-view .passed .item-description,
           .dark #table-view .passed .item-timespan,
           .dark #table-view .passed .task-checkbox label {
              color: hsl(var(--muted-foreground) / 0.6);
          }
          #table-view .passed .item-title i {
              color: hsl(var(--passed-color));
          }
           #table-view .passed .task-checkbox input {
              accent-color: hsl(var(--passed-color));
           }


          /* Task completion checkbox (Horizontal View) */
        #table-view .task-checkbox {
            margin-top: 8px;
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            color: hsl(var(--muted-foreground));
             cursor: pointer;
        }
        #table-view .task-checkbox input {
            margin-right: 6px;
             accent-color: hsl(var(--primary));
             cursor: pointer;
        }
        #table-view .completed {
            opacity: 0.7;
            background: hsl(var(--secondary) / 0.6);
             border-color: hsl(var(--muted));
             box-shadow: none;
             transition: opacity 0.3s ease, background 0.3s ease;
        }
         .dark #table-view .completed {
             background: hsl(var(--secondary) / 0.6);
         }
         #table-view .completed:hover {
             transform: none;
             box-shadow: none;
             border-color: hsl(var(--muted));
         }
          #table-view .completed::before {
              background: hsl(var(--muted-foreground));
          }
           #table-view .completed:hover::before {
               background: hsl(var(--primary)); /* Still highlight on hover */
           }

         #table-view .completed .item-title,
         #table-view .completed .item-description,
          #table-view .completed .item-timespan,
           #table-view .completed .task-checkbox label {
             text-decoration: line-through;
             color: hsl(var(--muted-foreground) / 0.8);
         }
          .dark #table-view .completed .item-title,
         .dark #table-view .completed .item-description,
          .dark #table-view .completed .item-timespan,
          .dark #table-view .completed .task-checkbox label {
             color: hsl(var(--muted-foreground) / 0.8);
         }
         #table-view .completed .item-title i {
             color: hsl(var(--muted-foreground));
         }
         #table-view .completed .task-checkbox input {
             accent-color: hsl(var(--muted-foreground));
         }


        /* Live Info, Countdown, and Progress styles */
        #live-info {
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            margin-bottom: 40px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }
        #live-info h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: hsl(var(--primary));
        }
        #live-info p {
            font-size: 1rem;
            color: hsl(var(--foreground));
        }
         #live-info #countdown {
            font-size: 1.1rem;
            font-weight: 500;
            color: hsl(var(--primary));
            margin-top: 15px;
        }

         #live-info #current-session-countdown {
             font-size: 0.9rem;
             font-weight: 400;
             color: hsl(var(--muted-foreground));
             margin-top: 8px;
             display: flex;
             align-items: center;
             justify-content: center;
         }
          #live-info #current-session-countdown i {
             margin-right: 6px;
             color: hsl(var(--ring));
          }

         #progress-section {
            margin-top: 30px;
            margin-bottom: 30px;
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }
         #progress-section h4 {
             font-size: 1.2rem;
             font-weight: 600;
             margin-bottom: 15px;
             color: hsl(var(--foreground));
             text-align: center;
         }
        
        #overall-progress {
            margin-bottom: 30px; /* Space below overall progress */
        }
        #overall-progress h5 {
             font-weight: 600;
             margin-bottom: 8px;
             color: hsl(var(--foreground));
        }
        #overall-progress-container {
            width: 100%;
            height: 12px; /* Thicker bar */
            background: hsl(var(--secondary));
            border-radius: 6px; /* Match height */
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }
        
        #overall-progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, hsl(var(--primary)), hsl(var(--ring)));
            border-radius: 6px;
            transition: width 0.5s ease-in-out;
        }
        
        #overall-progress-text {
            font-size: 0.9rem;
            color: hsl(var(--muted-foreground));
            text-align: right; /* Align text to the right */
            margin-top: 8px;
        }

         #module-progress {
             margin-top: 20px;
             text-align: left;
             font-size: 0.9rem;
             color: hsl(var(--muted-foreground));
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
             gap: 15px 20px;
         }
          #module-progress h5 {
             font-weight: 600;
             margin-bottom: 12px;
             color: hsl(var(--foreground));
             grid-column: 1 / -1; /* Span all columns */
          }
         #module-progress > div {
              display: flex;
              flex-direction: column;
              align-items: flex-start;
         }
          #module-progress .module-name {
             font-weight: 500;
             color: hsl(var(--foreground));
             margin-bottom: 4px;
              font-size: 0.95rem;
          }
           #module-progress .module-progress-bar-container {
              width: 100%;
              height: 8px;
              background: hsl(var(--secondary));
              border-radius: 4px;
              overflow: hidden;
              box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
           }
           #module-progress .module-progress-bar {
               height: 100%;
               width: 0%;
               background: hsl(var(--primary));
               border-radius: 4px;
               transition: width 0.5s ease-in-out, background-color 0.3s ease;
           }
            #module-progress .module-progress-bar[data-priority="1"] { background-color: hsl(var(--priority-1)); }
            #module-progress .module-progress-bar[data-priority="2"] { background-color: hsl(var(--priority-2)); }
            #module-progress .module-progress-bar[data-priority="3"] { background-color: hsl(var(--priority-3)); }
            #module-progress .module-progress-text {
                 font-size: 0.8rem;
                 color: hsl(var(--muted-foreground));
                 margin-top: 4px;
                 text-align: right;
                 width: 100%;
            }


          /* What's Next Section */
          #whats-next {
              background: hsl(var(--card));
              border: 1px solid hsl(var(--border));
              border-radius: var(--radius);
              padding: 15px;
              margin-top: 30px;
              margin-bottom: 30px;
              box-shadow: 0 4px 8px rgba(0,0,0,0.08);
              border-left: 4px solid hsl(var(--ring));
              display: none; /* Hidden by default, shown if there's a next item */
          }
           #whats-next h4 {
              font-size: 1.2rem;
              font-weight: 600;
              margin-bottom: 8px;
              color: hsl(var(--ring));
           }
           #whats-next p {
               font-size: 1rem;
               color: hsl(var(--foreground));
           }
            #whats-next .next-time {
                font-weight: 500;
                color: hsl(var(--primary));
                margin-right: 5px;
            }
            #whats-next i {
                 margin-right: 8px;
                 color: hsl(var(--primary));
            }
             #whats-next .next-countdown {
                 font-size: 0.9rem;
                 color: hsl(var(--muted-foreground));
                 margin-left: 10px;
                 display: inline-flex;
                 align-items: center;
             }
             #whats-next .next-countdown i {
                  margin-right: 4px;
                  font-size: 0.8rem;
                  color: hsl(var(--ring));
             }

          /* Motivational Message */
          #motivational-message {
               background: linear-gradient(to right, hsl(var(--primary) / 0.08), transparent);
               border-left: 3px solid hsl(var(--primary));
               padding: 15px;
               border-radius: var(--radius);
               margin-top: 30px;
               margin-bottom: 30px;
               font-style: italic;
               color: hsl(var(--foreground));
          }
          #motivational-message i {
               margin-right: 8px;
               color: hsl(var(--primary));
          }
           .dark #motivational-message {
               background: linear-gradient(to right, hsl(var(--primary) / 0.15), transparent);
           }

            /* Add to Calendar Button Styling */
           .add-to-calendar {
               margin-top: 10px;
               font-size: 0.8rem;
               color: hsl(var(--muted-foreground));
               display: flex;
               flex-wrap: wrap;
               gap: 6px;
               align-items: center;
           }
           .add-to-calendar button {
               background: hsl(var(--background));
               border: 1px solid hsl(var(--border));
               border-radius: 4px;
               padding: 4px 8px;
               font-size: 0.75rem;
               cursor: pointer;
               transition: all 0.2s ease;
               display: flex;
               align-items: center;
           }
           .dark .add-to-calendar button {
              background: hsl(var(--secondary));
           }
           .add-to-calendar button:hover {
                background: hsl(var(--secondary));
                border-color: hsl(var(--primary));
                color: hsl(var(--primary));
           }
            .add-to-calendar button i {
                margin-right: 4px;
            }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
             /* Utility Buttons */
            .utility-buttons {
                bottom: 1.5rem;
                right: 1.5rem;
                 gap: 0.75rem; /* More space on mobile */
            }
            .utility-buttons button {
                width: 3.5rem; /* Slightly larger tap area */
                height: 3.5rem;
            }
             .utility-buttons button i {
                 font-size: 1.4rem;
             }

             /* Live Info, etc. */
             #live-info, #motivational-message, #progress-section, #whats-next {
                 padding: 15px;
                 margin-top: 20px;
                 margin-bottom: 20px;
             }
             #live-info h3 { font-size: 1.3rem; }
             #live-info p { font-size: 0.9rem; }
             #live-info #countdown { font-size: 1rem; }
             #live-info #current-session-countdown { font-size: 0.85rem; }

             #progress-section h4 { font-size: 1.1rem; margin-bottom: 10px; }
             #overall-progress h5 { font-size: 0.95rem; margin-bottom: 6px; }
             #overall-progress-text { font-size: 0.8rem; }
             #module-progress h5 { font-size: 0.95rem; margin-bottom: 8px; }
             #module-progress .module-name { font-size: 0.9rem; }
             #module-progress .module-progress-text { font-size: 0.75rem; }

             #whats-next h4 { font-size: 1rem; margin-bottom: 6px; }
             #whats-next p { font-size: 0.9rem; }
             #whats-next .next-countdown { font-size: 0.8rem; margin-left: 5px;}

             #motivational-message { font-size: 0.9rem; padding: 12px; }

             /* Header back button adjustment */
            header .container .flex a.absolute {
                left: 10px;
                padding: 8px;
                font-size: 0.9rem;
            }
             header .container .flex h1 { font-size: 1.8rem; }
             header .container .flex p { font-size: 0.8rem; }


             /* Horizontal View Mobile */
             #table-view .day-column {
                 min-width: 200px;
                 width: 200px;
                 margin-right: 8px;
             }
              #table-view .day-header { font-size: 0.9rem; padding: 8px 10px; }
              #table-view .day-content { padding: 10px; gap: 10px; }
              #table-view .timetable-item { padding: 10px; min-height: 70px;}
              #table-view .item-timespan { font-size: 0.75rem; margin-bottom: 2px; }
              #table-view .item-title { font-size: 0.9rem; margin-bottom: 2px; }
              #table-view .item-title i { font-size: 0.8rem; }
              #table-view .item-description { font-size: 0.8rem; }
              #table-view .study-session .priority-tag { font-size: 0.65rem; }
              #table-view .task-checkbox { font-size: 0.8rem; margin-top: 6px;}
               .add-to-calendar button { font-size: 0.7rem; padding: 3px 6px; }
               .add-to-calendar button i { margin-right: 3px; }

        }

    </style>
</head>
<body class="min-h-screen">
    <!-- Hero Background -->
    <div class="hero-bg">
        <div class="gradient-blob gradient-blob-1"></div>
        <div class="gradient-blob gradient-blob-2"></div>
        <div class="floating-dot dot-p2 w-4 h-4 top-1/4 left-1/4" style="--x: 20px; --y: -10px; animation-delay: 0s;"></div>
        <div class="floating-dot dot-primary w-3 h-3 top-1/3 right-1/4" style="--x: -15px; --y: 15px; animation-delay: 1s;"></div>
        <div class="floating-dot dot-p1 w-2 h-2 bottom-1/4 left-1/3" style="--x: 10px; --y: 20px; animation-delay: 2s;"></div>
        <div class="floating-dot dot-p3 w-3 h-3 top-2/3 right-1/3" style="--x: -5px; --y: -25px; animation-delay: 3s;"></div>
         <div class="floating-dot dot-ring w-4 h-4 bottom-1/2 left-10" style="--x: 25px; --y: 5px; animation-delay: 0.5s;"></div>
         <div class="floating-dot dot-muted w-3 h-3 top-1/2 right-10" style="--x: -20px; --y: -20px; animation-delay: 2.5s;"></div>
    </div>

    <!-- Floating Particles -->
    <div class="floating-particles" id="particles"></div>

    <!-- Utility Buttons (Theme Toggle & View Toggle) -->
     <div class="utility-buttons">
         <button id="view-toggle" aria-label="Toggle View">
             <i class="fas fa-table"></i>
         </button>
         <button id="theme-toggle" aria-label="Toggle Theme">
             <i class="fas fa-moon"></i>
         </button>
     </div>


    <!-- Header section - Add back button -->
    <header class="bg-background/80 backdrop-blur-sm shadow-lg py-6">
        <div class="container mx-auto px-4">
            <div class="flex flex-col items-center relative">
                <a href="index.html" class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-primary/10 hover:bg-primary/20 transition-colors p-2 rounded-full text-primary">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <h1 class="text-2xl md:text-3xl font-bold" data-aos="fade-down">Mon Plan de Révision</h1>
                <p class="text-muted-foreground text-sm mt-1">1ère Année Technologie (LMD) - Université de Bejaia</p>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 max-w-3xl">

        <!-- Live Clock and Countdown -->
        <section id="live-info" data-aos="fade-up">
            <p><i class="fas fa-clock mr-2 text-primary"></i> Heure Actuelle: <span id="current-time"></span></p>
            <p class="mt-1"><i class="fas fa-calendar-day mr-2 text-primary"></i> Date Actuelle: <span id="current-date"></span></p>
            <p id="countdown" class="font-semibold mt-3"></p>
            <p id="current-session-countdown" class="hidden"></p>
        </section>

        <!-- What's Next Section -->
        <section id="whats-next" data-aos="fade-up" data-aos-delay="100">
             <h4><i class="fas fa-hourglass-half mr-2"></i> Prochaine Tâche</h4>
             <p id="next-task-info">Chargement...</p>
        </section>

        <!-- Motivational Message -->
        <section id="motivational-message" data-aos="fade-up" data-aos-delay="150">
            <p><i class="fas fa-lightbulb mr-2"></i><span id="daily-quote">Chargement message...</span></p>
        </section>

         <!-- Progress Section -->
         <section id="progress-section" data-aos="fade-up" data-aos-delay="200">
             <h4>Progression Globale</h4>
             <div id="overall-progress">
                  <h5>Plan Complet</h5>
                  <div id="overall-progress-container">
                      <div id="overall-progress-bar"></div>
                  </div>
                  <div id="overall-progress-text">0% terminé</div>
             </div>

             <div id="module-progress">
                 <h5>Progression par Module (Sessions Terminées)</h5>
                 <!-- Module progress bars will be injected here by JS -->
             </div>

         </section>


        <!-- Revision Plan Timeline (Vertical View) -->
        <section id="timeline-view" class="timeline" data-aos-container="timeline-items">
            <!-- Disclaimer -->
             <div class="timeline-item" data-aos="fade-up">
                <div class="timeline-marker"></div>
                 <div class="timeline-content break-time">
                    <span class="timeline-timespan">Conseil</span>
                    <h4><i class="fas fa-info-circle mr-2"></i> Note Importante</h4>
                    <p>Ce plan est une suggestion. Adaptez les horaires et les tâches selon votre rythme. Prenez des pauses régulières, dormez bien et mangez sainement.</p>
                 </div>
             </div>
            <!-- Timeline items will be injected here by JS -->
        </section>

        <!-- Revision Plan Timetable (Horizontal View) -->
         <section id="table-view">
             <div class="timetable-container">
                 <!-- Day columns will be injected here by JS -->
             </div>
         </section>


    </main>

    <!-- Footer -->
    <footer class="bg-background/80 backdrop-blur-sm py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <p class="text-muted-foreground">
                    &copy; 2025 Développé par Amara Mehdi<br>
                    Université de Bejaia
                </p>
            </div>
        </div>
    </footer>

    <!-- AOS Script -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        // Configure AOS to work with multiple containers if needed,
        // but default AOS scans the whole DOM. Let's rely on that for simplicity.
        AOS.init({
            duration: 800,
            once: false, // Animate elements every time they come into view
            offset: 120, // Offset (in px) from the original trigger point
            delay: 50, // Delay animation
        });
    </script>

    <!-- Custom Scripts -->
    <script>
        // --- Data Definition ---
        const scheduleData = [
             // MAY 2025
            { date: '2025-05-15', startTime: '09:00', endTime: '10:30', type: 'study', module: 'Mathématiques 2', task: 'Révision Concepts Clés', priority: 1, calendar: true },
            { date: '2025-05-15', startTime: '10:30', endTime: '11:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-15', startTime: '11:00', endTime: '12:00', type: 'study', module: 'Physique 2', task: 'Révision Chapitre 1', priority: 1, calendar: true },
            { date: '2025-05-15', startTime: '12:00', endTime: '14:00', type: 'free', module: 'Déjeuner & Temps Libre', task: 'Repas et détente', priority: null, calendar: false },
            { date: '2025-05-15', startTime: '14:00', endTime: '15:30', type: 'study', module: 'Informatique 2', task: 'Révision TP / Exercices', priority: 2, calendar: true },
            { date: '2025-05-15', startTime: '15:30', endTime: '16:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-15', startTime: '16:00', endTime: '17:30', type: 'study', module: 'Chimie 2', task: 'Révision Chapitre 1', priority: 1, calendar: true },
            { date: '2025-05-15', startTime: '17:30', endTime: '19:30', type: 'free', module: 'Dîner & Temps Libre', task: 'Repas du soir et détente', priority: null, calendar: false },
            { date: '2025-05-15', startTime: '19:30', endTime: '20:30', type: 'study', module: 'MP', task: 'Révision Chapitre 1', priority: 3, calendar: true },
            { date: '2025-05-15', startTime: '20:30', endTime: '22:00', type: 'free', module: 'Temps Libre', task: 'Détente en fin de journée', priority: null, calendar: false },

            { date: '2025-05-16', startTime: '09:00', endTime: '10:30', type: 'study', module: 'Mathématiques 2', task: 'Révision Chapitre 2', priority: 1, calendar: true },
            { date: '2025-05-16', startTime: '10:30', endTime: '11:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-16', startTime: '11:00', endTime: '12:00', type: 'study', module: 'Physique 2', task: 'Révision Chapitre 2', priority: 1, calendar: true },
            { date: '2025-05-16', startTime: '12:00', endTime: '14:00', type: 'free', module: 'Déjeuner & Temps Libre', task: 'Repas et détente', priority: null, calendar: false },
            { date: '2025-05-16', startTime: '14:00', endTime: '15:30', type: 'study', module: 'Informatique 2', task: 'Révision Chapitre 2', priority: 2, calendar: true },
            { date: '2025-05-16', startTime: '15:30', endTime: '16:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-16', startTime: '16:00', endTime: '17:30', type: 'study', module: 'Chimie 2', task: 'Révision Chapitre 2', priority: 1, calendar: true },
            { date: '2025-05-16', startTime: '17:30', endTime: '19:30', type: 'free', module: 'Dîner & Temps Libre', task: 'Repas du soir et détente', priority: null, calendar: false },
            { date: '2025-05-16', startTime: '19:30', endTime: '20:30', type: 'study', module: 'MP', task: 'Révision Chapitre 2', priority: 3, calendar: true },
            { date: '2025-05-16', startTime: '20:30', endTime: '22:00', type: 'free', module: 'Temps Libre', task: 'Détente en fin de journée', priority: null, calendar: false },

            { date: '2025-05-17', startTime: '09:00', endTime: '10:30', type: 'study', module: 'Mathématiques 2', task: 'Pratique TD 1 & 2', priority: 1, calendar: true },
            { date: '2025-05-17', startTime: '10:30', endTime: '11:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-17', startTime: '11:00', endTime: '12:00', type: 'study', module: 'Physique 2', task: 'Pratique TD 1 & 2', priority: 1, calendar: true },
            { date: '2025-05-17', startTime: '12:00', endTime: '14:00', type: 'free', module: 'Déjeuner & Temps Libre', task: 'Repas et détente', priority: null, calendar: false },
            { date: '2025-05-17', startTime: '14:00', endTime: '15:30', type: 'study', module: 'Informatique 2', task: 'Pratique TP 1 & 2', priority: 2, calendar: true },
            { date: '2025-05-17', startTime: '15:30', endTime: '16:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-17', startTime: '16:00', endTime: '17:30', type: 'study', module: 'Chimie 2', task: 'Pratique TD 1', priority: 1, calendar: true },
            { date: '2025-05-17', startTime: '17:30', endTime: '19:30', type: 'free', module: 'Dîner & Temps Libre', task: 'Repas du soir et détente', priority: null, calendar: false },
            { date: '2025-05-17', startTime: '19:30', endTime: '20:30', type: 'study', module: 'MST 2', task: 'Révision Pages Clés (1-8)', priority: 3, calendar: true },
            { date: '2025-05-17', startTime: '20:30', endTime: '22:00', type: 'free', module: 'Temps Libre', task: 'Détente en fin de journée', priority: null, calendar: false },

            { date: '2025-05-18', startTime: '09:00', endTime: '11:00', type: 'study', module: 'Mathématiques 2', task: 'Simulation Examen', priority: 1, calendar: true },
            { date: '2025-05-18', startTime: '11:00', endTime: '11:30', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-18', startTime: '11:30', endTime: '12:30', type: 'study', module: 'Mathématiques 2', task: 'Correction Simulation + Points Faibles', priority: 1, calendar: true },
            { date: '2025-05-18', startTime: '12:30', endTime: '14:00', type: 'free', module: 'Déjeuner & Temps Libre', task: 'Repas et détente', priority: null, calendar: false }, // Corrected time block overlap
            { date: '2025-05-18', startTime: '14:00', endTime: '15:30', type: 'study', module: 'Physique 2', task: 'Pratique Annales Intenses', priority: 1, calendar: true },
            { date: '2025-05-18', startTime: '15:30', endTime: '16:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-18', startTime: '16:00', endTime: '17:30', type: 'study', module: 'Chimie 2', task: 'Pratique Annales Intenses', priority: 1, calendar: true },
            { date: '2025-05-18', startTime: '17:30', endTime: '19:30', type: 'free', module: 'Dîner & Temps Libre', task: 'Repas du soir et détente', priority: null, calendar: false },
            { date: '2025-05-18', startTime: '19:30', endTime: '20:30', type: 'study', module: 'MST 2', task: 'Révision Finale Rapide', priority: 3, calendar: true },
            { date: '2025-05-18', startTime: '20:30', endTime: '22:00', type: 'free', module: 'Temps Libre', task: 'Détente en fin de journée', priority: null, calendar: false },

            { date: '2025-05-19', startTime: '09:00', endTime: '11:00', type: 'study', module: 'Mathématiques 2', task: 'Révision Générale + Annales', priority: 1, calendar: true },
            { date: '2025-05-19', startTime: '11:00', endTime: '11:30', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-19', startTime: '11:30', endTime: '13:00', type: 'study', module: 'Informatique 2', task: 'Pratique Annales Intenses', priority: 2, calendar: true },
            { date: '2025-05-19', startTime: '13:00', endTime: '14:00', type: 'free', module: 'Déjeuner & Temps Libre', task: 'Repas et détente', priority: null, calendar: false }, // Corrected time block overlap
            { date: '2025-05-19', startTime: '14:00', endTime: '15:30', type: 'study', module: 'Chimie 2', task: 'Révision Générale + Annales', priority: 1, calendar: true },
            { date: '2025-05-19', startTime: '15:30', endTime: '16:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-19', startTime: '16:00', endTime: '17:30', type: 'study', module: 'Physique 2', task: 'Révision Générale + Annales', priority: 1, calendar: true },
            { date: '2025-05-19', startTime: '17:30', endTime: '19:30', type: 'free', module: 'Dîner & Temps Libre', task: 'Repas du soir et détente', priority: null, calendar: false },
            { date: '2025-05-19', startTime: '19:30', endTime: '20:30', type: 'study', module: 'MP', task: 'Révision Chapitre 1 & 2 Finale', priority: 3, calendar: true },
            { date: '2025-05-19', startTime: '20:30', endTime: '22:00', type: 'free', module: 'Temps Libre', task: 'Détente en fin de journée', priority: null, calendar: false },

            // May 20 (MP Exam)
            { date: '2025-05-20', startTime: '09:00', endTime: '11:00', type: 'study', module: 'MP', task: 'Révision Finale Avant Examen', priority: 3, calendar: true },
            { date: '2025-05-20', startTime: '11:00', endTime: '14:00', type: 'free', module: 'Déjeuner & Préparation Examen', task: 'Repas, dernier coup d\'œil, direction la fac.', priority: null, calendar: false },
            { date: '2025-05-20', startTime: '14:30', endTime: '16:00', type: 'exam', module: 'MP', task: 'EXAMEN MP', priority: null, calendar: true },
            { date: '2025-05-20', startTime: '16:00', endTime: '22:00', type: 'free', module: 'Après Examen', task: 'Détente bien méritée.', priority: null, calendar: false },

            // May 21
            { date: '2025-05-21', startTime: '09:00', endTime: '11:00', type: 'study', module: 'Informatique 2', task: 'Pratique Annales Intenses', priority: 2, calendar: true },
            { date: '2025-05-21', startTime: '11:00', endTime: '11:30', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-21', startTime: '11:30', endTime: '12:00', type: 'study', module: 'Informatique 2', task: 'Révision Finale', priority: 2, calendar: true },
            { date: '2025-05-21', startTime: '12:00', endTime: '14:00', type: 'free', module: 'Déjeuner & Temps Libre', task: 'Repas et détente.', priority: null, calendar: false },
            { date: '2025-05-21', startTime: '14:00', endTime: '15:30', type: 'study', module: 'Mathématiques 2', task: 'Pratique Annales', priority: 1, calendar: true },
            { date: '2025-05-21', startTime: '15:30', endTime: '16:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-21', startTime: '16:00', endTime: '17:30', type: 'study', module: 'Physique 2', task: 'Révision Chapitre 3', priority: 1, calendar: true },
            { date: '2025-05-21', startTime: '17:30', endTime: '19:30', type: 'free', module: 'Dîner & Temps Libre', task: 'Repas du soir et détente.', priority: null, calendar: false },
            { date: '2025-05-21', startTime: '19:30', endTime: '21:00', type: 'study', module: 'Chimie 2', task: 'Révision Chapitre 3', priority: 1, calendar: true },
            { date: '2025-05-21', startTime: '21:00', endTime: '22:00', type: 'free', module: 'Temps Libre', task: 'Détente en fin de journée.', priority: null, calendar: false },

            // May 22 (Info 2 Exam)
            { date: '2025-05-22', startTime: '09:00', endTime: '11:00', type: 'study', module: 'Informatique 2', task: 'Révision Finale Avant Examen', priority: 2, calendar: true },
            { date: '2025-05-22', startTime: '11:00', endTime: '12:00', type: 'free', module: 'Préparation Examen', task: 'Repas léger et préparation.', priority: null, calendar: false },
            { date: '2025-05-22', startTime: '12:30', endTime: '14:00', type: 'exam', module: 'Informatique 2', task: 'EXAMEN Informatique 2', priority: null, calendar: true },
            { date: '2025-05-22', startTime: '14:00', endTime: '17:00', type: 'free', module: 'Après Examen', task: 'Détente. Ne pensez plus à l\'examen.', priority: null, calendar: false },
            { date: '2025-05-22', startTime: '17:00', endTime: '18:30', type: 'study', module: 'Mathématiques 2', task: 'Pratique TD 3 + Annales', priority: 1, calendar: true },
            { date: '2025-05-22', startTime: '18:30', endTime: '20:00', type: 'free', module: 'Dîner & Temps Libre', task: 'Repas du soir et détente.', priority: null, calendar: false },
            { date: '2025-05-22', startTime: '20:00', endTime: '21:30', type: 'study', module: 'Physique 2', task: 'Révision Chapitre 4', priority: 1, calendar: true },
            { date: '2025-05-22', startTime: '21:30', endTime: '22:00', type: 'free', module: 'Temps Libre', task: 'Détente en fin de journée.', priority: null, calendar: false },

            // May 23
            { date: '2025-05-23', startTime: '09:00', endTime: '11:00', type: 'study', module: 'Mathématiques 2', task: 'Pratique Annales Intenses', priority: 1, calendar: true },
            { date: '2025-05-23', startTime: '11:00', endTime: '11:30', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-23', startTime: '11:30', endTime: '12:30', type: 'study', module: 'Mathématiques 2', task: 'Révision Finale Concepts', priority: 1, calendar: true },
            { date: '2025-05-23', startTime: '12:30', endTime: '14:00', type: 'free', module: 'Déjeuner & Temps Libre', task: 'Repas et détente.', priority: null, calendar: false }, // Corrected time block overlap
            { date: '2025-05-23', startTime: '14:00', endTime: '15:30', type: 'study', module: 'Chimie 2', task: 'Révision Chapitre 4 & 5', priority: 1, calendar: true },
            { date: '2025-05-23', startTime: '15:30', endTime: '16:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-23', startTime: '16:00', endTime: '17:30', type: 'study', module: 'Physique 2', task: 'Révision Chapitre 5', priority: 1, calendar: true },
            { date: '2025-05-23', startTime: '17:30', endTime: '19:30', type: 'free', module: 'Dîner & Temps Libre', task: 'Repas du soir et détente.', priority: null, calendar: false },
            { date: '2025-05-23', startTime: '19:30', endTime: '20:30', type: 'study', module: 'Anglais 2', task: 'Révision Leçon 3 + Annales', priority: 3, calendar: true },
            { date: '2025-05-23', startTime: '20:30', endTime: '22:00', type: 'free', module: 'Temps Libre', task: 'Détente en fin de journée.', priority: null, calendar: false },

            // May 24
            { date: '2025-05-24', startTime: '09:00', endTime: '11:00', type: 'study', module: 'Mathématiques 2', task: 'Simulation Examen Finale', priority: 1, calendar: true },
            { date: '2025-05-24', startTime: '11:00', endTime: '11:30', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-24', startTime: '11:30', endTime: '12:30', type: 'study', module: 'Mathématiques 2', task: 'Correction Simulation + Points Faibles', priority: 1, calendar: true },
            { date: '2025-05-24', startTime: '12:30', endTime: '14:00', type: 'free', module: 'Déjeuner & Temps Libre', task: 'Repas et détente.', priority: null, calendar: false }, // Corrected time block overlap
            { date: '2025-05-24', startTime: '14:00', endTime: '15:30', type: 'study', module: 'Chimie 2', task: 'Pratique Annales', priority: 1, calendar: true },
            { date: '2025-05-24', startTime: '15:30', endTime: '16:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-24', startTime: '16:00', endTime: '17:00', type: 'study', module: 'MST 2', task: 'Révision Très Rapide', priority: 3, calendar: true },
            { date: '2025-05-24', startTime: '17:00', endTime: '19:00', type: 'free', module: 'Dîner & Temps Libre', task: 'Repas du soir et détente.', priority: null, calendar: false },
            { date: '2025-05-24', startTime: '19:00', endTime: '20:30', type: 'study', module: 'Physique 2', task: 'Pratique Annales Intenses', priority: 1, calendar: true },
            { date: '2025-05-24', startTime: '20:30', endTime: '22:00', type: 'free', module: 'Temps Libre', task: 'Détente en fin de journée.', priority: null, calendar: false },

            // May 25 (Math 2 Exam)
            { date: '2025-05-25', startTime: '08:00', endTime: '10:00', type: 'study', module: 'Mathématiques 2', task: 'Révision Finale Avant Examen', priority: 1, calendar: true },
            { date: '2025-05-25', startTime: '10:00', endTime: '10:30', type: 'free', module: 'Préparation Examen', task: 'Direction la salle d\'examen.', priority: null, calendar: false },
            { date: '2025-05-25', startTime: '10:30', endTime: '12:00', type: 'exam', module: 'Mathématiques 2', task: 'EXAMEN Mathématiques 2', priority: null, calendar: true },
            { date: '2025-05-25', startTime: '12:00', endTime: '16:00', type: 'free', module: 'Après Examen', task: 'Détente prolongée.', priority: null, calendar: false },
            { date: '2025-05-25', startTime: '16:00', endTime: '17:00', type: 'study', module: 'MST 2', task: 'Révision Très Rapide', priority: 3, calendar: true },
            { date: '2025-05-25', startTime: '17:00', endTime: '17:30', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-25', startTime: '17:30', endTime: '19:00', type: 'study', module: 'Physique 2', task: 'Pratique Annales Intenses', priority: 1, calendar: true },
            { date: '2025-05-25', startTime: '19:00', endTime: '20:30', type: 'free', module: 'Dîner & Temps Libre', task: 'Repas du soir et détente.', priority: null, calendar: false },
            { date: '2025-05-25', startTime: '20:30', endTime: '21:30', type: 'study', module: 'Anglais 2', task: 'Révision Finale Rapide', priority: 3, calendar: true },
            { date: '2025-05-25', startTime: '21:30', endTime: '22:00', type: 'free', module: 'Temps Libre', task: 'Détente en fin de journée.', priority: null, calendar: false },

            // May 26
            { date: '2025-05-26', startTime: '09:00', endTime: '11:00', type: 'study', module: 'MST 2', task: 'Révision Finale Avant Examen', priority: 3, calendar: true },
            { date: '2025-05-26', startTime: '11:00', endTime: '14:00', type: 'free', module: 'Déjeuner & Préparation Examen', task: 'Repas et préparation.', priority: null, calendar: false },
            { date: '2025-05-26', startTime: '14:00', endTime: '15:30', type: 'study', module: 'Chimie 2', task: 'Pratique Annales Intenses', priority: 1, calendar: true },
            { date: '2025-05-26', startTime: '15:30', endTime: '16:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-26', startTime: '16:00', endTime: '17:30', type: 'study', module: 'Physique 2', task: 'Révision Générale Concepts', priority: 1, calendar: true },
            { date: '2025-05-26', startTime: '17:30', endTime: '19:30', type: 'free', module: 'Dîner & Temps Libre', task: 'Repas du soir et détente.', priority: null, calendar: false },
            { date: '2025-05-26', startTime: '19:30', endTime: '20:30', type: 'study', module: 'Anglais 2', task: 'Pratique Annales', priority: 3, calendar: true },
            { date: '2025-05-26', startTime: '20:30', endTime: '22:00', type: 'free', module: 'Temps Libre', task: 'Détente en fin de journée.', priority: null, calendar: false },

            // May 27 (MST 2 Exam)
            { date: '2025-05-27', startTime: '09:00', endTime: '11:00', type: 'study', module: 'MST 2', task: 'Révision Finale Avant Examen', priority: 3, calendar: true },
            { date: '2025-05-27', startTime: '11:00', endTime: '14:00', type: 'free', module: 'Déjeuner & Préparation Examen', task: 'Repas et préparation.', priority: null, calendar: false },
            { date: '2025-05-27', startTime: '14:30', endTime: '16:00', type: 'exam', module: 'MST 2', task: 'EXAMEN MST 2', priority: null, calendar: true },
            { date: '2025-05-27', startTime: '16:00', endTime: '19:00', type: 'free', module: 'Après Examen', task: 'Détente. Focus maintenant sur les examens restants.', priority: null, calendar: false },
            { date: '2025-05-27', startTime: '19:00', endTime: '20:30', type: 'study', module: 'Chimie 2', task: 'Pratique Annales', priority: 1, calendar: true },
            { date: '2025-05-27', startTime: '20:30', endTime: '22:00', type: 'free', module: 'Dîner & Fin de Journée', task: 'Repas du soir et repos.', priority: null, calendar: false },

            // May 28
            { date: '2025-05-28', startTime: '09:00', endTime: '11:00', type: 'study', module: 'Chimie 2', task: 'Révision Finale Concepts & Formules', priority: 1, calendar: true },
            { date: '2025-05-28', startTime: '11:00', endTime: '11:30', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-28', startTime: '11:30', endTime: '13:00', type: 'study', module: 'Chimie 2', task: 'Simulation Examen', priority: 1, calendar: true },
            { date: '2025-05-28', startTime: '13:00', endTime: '14:00', type: 'free', module: 'Déjeuner & Temps Libre', task: 'Repas et détente.', priority: null, calendar: false }, // Corrected time block overlap
            { date: '2025-05-28', startTime: '14:00', endTime: '15:30', type: 'study', module: 'Physique 2', task: 'Pratique Annales Chapitre 4', priority: 1, calendar: true },
            { date: '2025-05-28', startTime: '15:30', endTime: '16:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-28', startTime: '16:00', endTime: '17:00', type: 'study', module: 'Anglais 2', task: 'Simulation Examen', priority: 3, calendar: true },
            { date: '2025-05-28', startTime: '17:00', endTime: '19:00', type: 'free', module: 'Dîner & Temps Libre', task: 'Repas du soir et détente.', priority: null, calendar: false },
            { date: '2025-05-28', startTime: '19:00', endTime: '20:30', type: 'study', module: 'Physique 2', task: 'Pratique Annales Chapitre 5', priority: 1, calendar: true },
            { date: '2025-05-28', startTime: '20:30', endTime: '22:00', type: 'free', module: 'Temps Libre', task: 'Détente en fin de journée.', priority: null, calendar: false },

            // May 29 (Chimie 2 Exam)
            { date: '2025-05-29', startTime: '09:00', endTime: '11:00', type: 'study', module: 'Chimie 2', task: 'Révision Finale Avant Examen', priority: 1, calendar: true },
            { date: '2025-05-29', startTime: '11:00', endTime: '12:00', type: 'free', module: 'Préparation Examen', task: 'Repas léger et préparation.', priority: null, calendar: false },
            { date: '2025-05-29', startTime: '12:30', endTime: '14:00', type: 'exam', module: 'Chimie 2', task: 'EXAMEN Chimie 2', priority: null, calendar: true },
            { date: '2025-05-29', startTime: '14:00', endTime: '17:00', type: 'free', module: 'Après Examen', task: 'Détente. Préparez-vous mentalement pour Anglais et Physique.', priority: null, calendar: false },
            { date: '2025-05-29', startTime: '17:00', endTime: '18:30', type: 'study', module: 'Anglais 2', task: 'Révision Finale Rapide', priority: 3, calendar: true },
            { date: '2025-05-29', startTime: '18:30', endTime: '22:00', type: 'free', module: 'Dîner & Fin de Journée', task: 'Repas du soir et repos.', priority: null, calendar: false },

            // May 30
            { date: '2025-05-30', startTime: '09:00', endTime: '11:00', type: 'study', module: 'Physique 2', task: 'Pratique Annales Intenses', priority: 1, calendar: true },
            { date: '2025-05-30', startTime: '11:00', endTime: '11:30', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-30', startTime: '11:30', endTime: '13:00', type: 'study', module: 'Physique 2', task: 'Correction Annales + Points Faibles', priority: 1, calendar: true },
            { date: '2025-05-30', startTime: '13:00', endTime: '14:00', type: 'free', module: 'Déjeuner & Temps Libre', task: 'Repas et détente.', priority: null, calendar: false }, // Corrected time block overlap
            { date: '2025-05-30', startTime: '14:00', endTime: '15:30', type: 'study', module: 'Chimie 2', task: 'Révision Formules Finales', priority: 1, calendar: true }, // This task seems odd after the exam on May 29, maybe keep it as light review?
            { date: '2025-05-30', startTime: '15:30', endTime: '16:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-05-30', startTime: '16:00', endTime: '17:00', type: 'study', module: 'Anglais 2', task: 'Simulation Examen', priority: 3, calendar: true },
            { date: '2025-05-30', startTime: '17:00', endTime: '19:00', type: 'free', module: 'Dîner & Temps Libre', task: 'Repas du soir et détente.', priority: null, calendar: false },
            { date: '2025-05-30', startTime: '19:00', endTime: '20:30', type: 'study', module: 'Physique 2', task: 'Révision Formules & Théorèmes', priority: 1, calendar: true },
            { date: '2025-05-30', startTime: '20:30', endTime: '22:00', type: 'free', module: 'Temps Libre', task: 'Détente en fin de journée.', priority: null, calendar: false },

            // May 31 (Anglais 2 Exam)
            { date: '2025-05-31', startTime: '09:00', endTime: '11:00', type: 'study', module: 'Anglais 2', task: 'Révision Finale Avant Examen', priority: 3, calendar: true },
            { date: '2025-05-31', startTime: '11:00', endTime: '14:00', type: 'free', module: 'Déjeuner & Préparation Examen', task: 'Repas et préparation.', priority: null, calendar: false },
            { date: '2025-05-31', startTime: '14:30', endTime: '16:00', type: 'exam', module: 'Anglais 2', task: 'EXAMEN Anglais 2', priority: null, calendar: true },
            { date: '2025-05-31', startTime: '16:00', endTime: '19:00', type: 'free', module: 'Après Examen', task: 'Détente. Concentration maximale sur Physique 2.', priority: null, calendar: false },
            { date: '2025-05-31', startTime: '19:00', endTime: '20:30', type: 'study', module: 'Physique 2', task: 'Simulation Examen', priority: 1, calendar: true },
            { date: '2025-05-31', startTime: '20:30', endTime: '22:00', type: 'free', module: 'Dîner & Fin de Journée', task: 'Repas du soir et repos.', priority: null, calendar: false },

             // June 1
            { date: '2025-06-01', startTime: '09:00', endTime: '11:30', type: 'study', module: 'Physique 2', task: 'Pratique Annales Intenses', priority: 1, calendar: true },
            { date: '2025-06-01', startTime: '11:30', endTime: '12:00', type: 'break', module: 'Pause', task: 'Break', priority: null, calendar: false },
            { date: '2025-06-01', startTime: '12:00', endTime: '13:00', type: 'study', module: 'Physique 2', task: 'Révision Formules & Théorèmes', priority: 1, calendar: true },
            { date: '2025-06-01', startTime: '13:00', endTime: '14:00', type: 'free', module: 'Déjeuner & Temps Libre', task: 'Repas et détente.', priority: null, calendar: false }, // Corrected time block overlap
            { date: '2025-06-01', startTime: '14:00', endTime: '16:00', type: 'study', module: 'Physique 2', task: 'Correction Annales', priority: 1, calendar: true },
            { date: '2025-06-01', startTime: '16:00', endTime: '22:00', type: 'free', module: 'Temps Libre Soirée', task: 'Détendez-vous. Ne faites plus de révision intense.', priority: null, calendar: false },

             // June 2 (Physique 2 Exam)
            { date: '2025-06-02', startTime: '08:00', endTime: '10:00', type: 'study', module: 'Physique 2', task: 'Révision Finale Avant Examen', priority: 1, calendar: true },
            { date: '2025-06-02', startTime: '10:00', endTime: '12:00', type: 'free', module: 'Préparation Examen', task: 'Dernière préparation, direction la salle d\'examen.', priority: null, calendar: false },
            { date: '2025-06-02', startTime: '12:30', endTime: '14:00', type: 'exam', module: 'Physique 2', task: 'EXAMEN Physique 2', priority: null, calendar: true },
            { date: '2025-06-02', startTime: '14:00', endTime: '22:00', type: 'free', module: 'FIN DES EXAMENS !', task: 'Félicitations, vous avez terminé ! Profitez bien de votre liberté retrouvée !', priority: null, calendar: false },
        ];

        // Add unique IDs and full Date objects to data
        scheduleData.forEach(item => {
            item.id = `${item.date}-${item.startTime.replace(':', '')}-${item.module.replace(/[^a-zA-Z0-9]/g, '')}-${item.task.replace(/[^a-zA-Z0-9]/g, '').substring(0, 10)}`;
             item.startDateTime = new Date(`${item.date}T${item.startTime}:00`);
             item.endDateTime = new Date(`${item.date}T${item.endTime}:00`);
             // Handle cases where end time is next day (e.g., midnight wrap-around)
             if (item.endTime === '00:00' && item.startTime !== '00:00') {
                  item.endDateTime.setDate(item.endDateTime.getDate() + 1);
             }
             // Ensure end time is strictly after start time for comparisons
              if (item.endDateTime <= item.startDateTime) {
                 item.endDateTime.setDate(item.endDateTime.getDate() + 1);
             }

        });

        // Group data by day for easier rendering
        const scheduleByDay = scheduleData.reduce((acc, item) => {
            const date = item.date;
            if (!acc[date]) {
                acc[date] = [];
            }
            acc[date].push(item);
            return acc;
        }, {});

        const motivationalQuotes = [
            "Chaque effort vous rapproche de la réussite. Tenez bon !",
            "La persévérance est la clé. Vous êtes capable !",
            "Visualisez votre succès. Travaillez pour l'atteindre.",
            "Un jour à la fois, une tâche à la fois. Vous avancez.",
            "N'abandonnez pas ! La ligne d'arrivée est en vue.",
            "Croyez en vous et en vos capacités.",
            "La difficulté renforce. Chaque défi vous rend plus fort.",
            "Respirez, concentrez-vous et donnez le meilleur de vous-même.",
            "Soyez fier de chaque petit progrès.",
            "La réussite n'est pas finale, l'échec n'est pas fatal : c'est le courage de continuer qui compte.",
             "Le chemin vers le succès est toujours en construction.",
             "Transformez les obstacles en opportunités.",
             "Chaque session de révision est une étape vers la maîtrise.",
             "Restez positif, concentrez-vous sur vos objectifs.",
             "Vous avez les ressources nécessaires en vous.",
             "Petit à petit, l'oiseau fait son nid de notes excellentes.",
             "La connaissance est votre super-pouvoir.",
             "Votre potentiel est immense. Libérez-le par le travail.",
             "Les examens sont des étapes, pas des obstacles.",
             "Concentration, discipline, succès."
         ];

         const dayNames = ['Dim.', 'Lun.', 'Mar.', 'Mer.', 'Jeu.', 'Ven.', 'Sam.'];


        // --- Theme Toggle and Particles ---
        function toggleTheme() {
            const body = document.body;
            const themeToggleIcon = document.querySelector('#theme-toggle i');

            document.documentElement.classList.add('theme-transition');

            if (body.classList.contains('dark')) {
                body.classList.remove('dark');
                themeToggleIcon.classList.remove('fa-sun');
                themeToggleIcon.classList.add('fa-moon');
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark');
                themeToggleIcon.classList.remove('fa-moon');
                themeToggleIcon.classList.add('fa-sun');
                localStorage.setItem('theme', 'dark');
            }

             window.setTimeout(() => {
                  document.documentElement.classList.remove('theme-transition');
             }, 500);

             createParticles(); // Recreate particles for color theme
        }

         function applySavedTheme() {
             const savedTheme = localStorage.getItem('theme');
             const themeToggleIcon = document.querySelector('#theme-toggle i');
             if (savedTheme === 'dark') {
                 document.body.classList.add('dark');
                 if (themeToggleIcon) {
                      themeToggleIcon.classList.remove('fa-moon');
                      themeToggleIcon.classList.add('fa-sun');
                 }
             } else {
                 document.body.classList.remove('dark');
                 if (themeToggleIcon) {
                     themeToggleIcon.classList.remove('fa-sun');
                     themeToggleIcon.classList.add('fa-moon');
                 }
             }
         }


         function createParticles() {
             const particlesContainer = document.getElementById('particles');
             // Get colors dynamically
             const style = getComputedStyle(document.body);
             const colors = [
                 style.getPropertyValue('--primary'),
                 style.getPropertyValue('--ring'),
                 style.getPropertyValue('--accent'),
                 style.getPropertyValue('--muted-foreground')
             ].map(color => color.trim() + ' / 0.6)');

             particlesContainer.innerHTML = ''; // Clear existing particles

             const numParticles = window.innerWidth > 768 ? 60 : 40;

             for (let i = 0; i < numParticles; i++) {
                 const particle = document.createElement('div');
                 particle.className = 'particle';

                 const x = Math.random() * 100;
                 const y = Math.random() * 100;
                 const size = Math.random() * 4 + 2;
                 const color = colors[Math.floor(Math.random() * colors.length)];
                 const moveRange = 30;
                 const moveX = (Math.random() - 0.5) * moveRange * 2;
                 const moveY = (Math.random() - 0.5) * moveRange * 2;
                 const animationDuration = 10 + Math.random() * 10;
                 const animationDelay = Math.random() * 8;

                 particle.style.cssText = `
                    left: ${x}vw;
                    top: ${y}vh;
                    width: ${size}px;
                    height: ${size}px;
                    background-color: ${color};
                    --x: ${moveX}px;
                    --y: ${moveY}px;
                    animation-delay: ${animationDelay}s;
                    animation-duration: ${animationDuration}s;
                    opacity: ${0.2 + Math.random() * 0.4};
                 `;

                 particlesContainer.appendChild(particle);
             }
         }


        // --- View Toggle ---
        function toggleView() {
            const timelineView = document.getElementById('timeline-view');
            const tableView = document.getElementById('table-view');
            const viewToggleBtn = document.getElementById('view-toggle');
            const viewToggleIcon = viewToggleBtn.querySelector('i');

            if (timelineView.style.display !== 'none') {
                // Currently on Timeline view, switch to Table
                timelineView.style.display = 'none';
                tableView.style.display = 'block';
                viewToggleIcon.classList.remove('fa-table');
                viewToggleIcon.classList.add('fa-list');
                localStorage.setItem('view', 'table');
                 scrollToCurrent('table'); // Scroll to current day/session in table view
            } else {
                // Currently on Table view, switch to Timeline
                tableView.style.display = 'none';
                timelineView.style.display = 'block';
                 viewToggleIcon.classList.remove('fa-list');
                viewToggleIcon.classList.add('fa-table');
                localStorage.setItem('view', 'timeline');
                 scrollToCurrent('timeline'); // Scroll to current day/session in timeline view
            }
             // Re-initialize AOS after view change if needed - AOS usually scans visible elements.
             // Let's rely on AOS's default behavior first. If animations seem broken, re-init.
             // AOS.refresh(); // Can be uncommented if needed
        }

        function applySavedView() {
            const savedView = localStorage.getItem('view') || 'timeline'; // Default to timeline
            const timelineView = document.getElementById('timeline-view');
            const tableView = document.getElementById('table-view');
            const viewToggleIcon = document.getElementById('view-toggle')?.querySelector('i');

            if (savedView === 'table') {
                timelineView.style.display = 'none';
                tableView.style.display = 'block';
                 if (viewToggleIcon) {
                     viewToggleIcon.classList.remove('fa-table');
                     viewToggleIcon.classList.add('fa-list');
                 }
            } else {
                tableView.style.display = 'none';
                timelineView.style.display = 'block';
                 if (viewToggleIcon) {
                     viewToggleIcon.classList.remove('fa-list');
                     viewToggleIcon.classList.add('fa-table');
                 }
            }
        }


        // --- Rendering Functions ---

        function renderTimeline() {
             const timelineContainer = document.getElementById('timeline-view').querySelector('.timeline');
             if (!timelineContainer) return;

             // Clear existing items (except the disclaimer)
             timelineContainer.querySelectorAll('.timeline-item:not(:first-child)').forEach(item => item.remove());

             const disclaimerItem = timelineContainer.querySelector('.timeline-item:first-child');
             const fragment = document.createDocumentFragment();

             Object.keys(scheduleByDay).sort().forEach(dateKey => {
                 const date = new Date(dateKey);
                 const dayName = dayNames[date.getDay()];
                 const day = date.getDate();
                 const month = date.toLocaleString('fr-FR', { month: 'short' });

                 // Add Day Item
                 const dayItem = document.createElement('div');
                 dayItem.className = 'timeline-item day-item';
                 dayItem.dataset.date = dateKey;
                 // Add data-aos here if needed for the day header itself
                 dayItem.innerHTML = `
                     <div class="timeline-date"><h3><i class="fas fa-calendar-day mr-2"></i>${dayName}. ${day} ${month}</h3></div>
                     <div class="timeline-marker"></div>
                 `;
                 fragment.appendChild(dayItem);

                 // Add items for this day
                 scheduleByDay[dateKey].forEach(item => {
                     const itemElement = document.createElement('div');
                     itemElement.className = `timeline-item ${item.type}-event`; // Use type for class
                     itemElement.dataset.itemId = item.id; // Use unique ID
                     itemElement.dataset.date = item.date;
                     itemElement.dataset.timeStart = item.startTime;
                     itemElement.dataset.timeEnd = item.endTime;
                     itemElement.dataset.module = item.module;

                     // Add data-aos here for individual items
                     itemElement.setAttribute('data-aos', 'fade-up');
                     itemElement.setAttribute('data-aos-delay', Math.floor(Math.random() * 150)); // Random delay for effect

                     let priorityTag = '';
                     if (item.type === 'study' && item.priority) {
                          priorityTag = `<span class="priority-tag p${item.priority}">Prio ${item.priority}</span>`;
                          if (item.task.includes('EXAM J-')) {
                              priorityTag = `<span class="priority-tag p${item.priority}">${item.task.substring(item.task.indexOf('EXAM'))}</span>`;
                          }
                     } else if (item.type === 'study' && item.task.includes('EXAM J-')) {
                         // Handle EXAM J-X priority styling even if priority property isn't set
                         const match = item.task.match(/EXAM J-(\d+)/);
                         if (match && match[1] <= 3) { // Apply priority coloring for J-3 or less
                              priorityTag = `<span class="priority-tag p1">${item.task.substring(item.task.indexOf('EXAM'))}</span>`;
                         } else {
                             priorityTag = `<span class="priority-tag p3">${item.task.substring(item.task.indexOf('EXAM'))}</span>`;
                         }
                     } else if (item.type === 'exam') {
                          priorityTag = `<span class="priority-tag p1">EXAM</span>`;
                     }


                     const icon = item.type === 'study' ? '<i class="fas fa-book-open mr-2"></i>' :
                                  item.type === 'break' ? '<i class="fas fa-mug-hot mr-2"></i>' :
                                  item.type === 'free' ? '<i class="fas fa-smile mr-2"></i>' :
                                  item.type === 'exam' ? '<i class="fas fa-file-alt mr-2"></i>' : '';

                     const title = item.type === 'exam' ? item.task : item.module;
                     const description = item.type === 'exam' ? `Bonne chance ! Salle: À vérifier sur l'affichage officiel.` : item.task;


                     itemElement.innerHTML = `
                         <div class="timeline-marker"></div>
                         <div class="timeline-content ${item.type === 'study' ? 'study-session' : item.type === 'break' || item.type === 'free' ? 'break-time' : 'exam-event'}">
                             <span class="timeline-timespan">${item.startTime} - ${item.endTime}</span>
                             <h4>${icon}${title} ${priorityTag}</h4>
                             <p>${description}</p>
                             ${item.type === 'study' ? `<label class="task-checkbox"><input type="checkbox" data-task-id="${item.id}" aria-label="Marquer cette tâche comme terminée"> Marquer comme terminé</label>` : ''}
                              ${item.calendar ? `<div class="add-to-calendar"><button data-item-id="${item.id}"><i class="fas fa-calendar-plus"></i> Ajouter au calendrier</button></div>` : ''}
                         </div>
                     `;
                      fragment.appendChild(itemElement);
                 });
             });

             // Append all items to the timeline container (after the disclaimer)
             timelineContainer.appendChild(fragment);

             // Attach event listeners after rendering
             attachTaskCompletionListeners();
             attachCalendarButtonListeners();
             updateProgress(); // Update progress after rendering items
        }


        function renderTable() {
             const tableViewContainer = document.getElementById('table-view').querySelector('.timetable-container');
             if (!tableViewContainer) return;

             tableViewContainer.innerHTML = ''; // Clear existing columns

             const fragment = document.createDocumentFragment();

             Object.keys(scheduleByDay).sort().forEach(dateKey => {
                 const date = new Date(dateKey);
                 const dayName = dayNames[date.getDay()];
                 const day = date.getDate();
                 const month = date.toLocaleString('fr-FR', { month: 'short' });

                 // Create Day Column
                 const dayColumn = document.createElement('div');
                 dayColumn.className = 'day-column';
                 dayColumn.dataset.date = dateKey;
                 dayColumn.dataset.aos = 'fade-left'; // Add AOS to columns
                 dayColumn.dataset.aosDelay = Math.floor(Math.random() * 100);


                 dayColumn.innerHTML = `
                     <div class="day-header">${dayName}. ${day} ${month}</div>
                     <div class="day-content">
                         <!-- Items for this day will be injected here -->
                     </div>
                 `;

                 const dayContent = dayColumn.querySelector('.day-content');
                 const dayFragment = document.createDocumentFragment();

                 // Add items for this day
                 scheduleByDay[dateKey].forEach(item => {
                     const itemElement = document.createElement('div');
                     itemElement.className = `timetable-item ${item.type}-event`;
                     itemElement.dataset.itemId = item.id; // Use unique ID
                     itemElement.dataset.date = item.date;
                     itemElement.dataset.timeStart = item.startTime;
                     itemElement.dataset.timeEnd = item.endTime;
                     itemElement.dataset.module = item.module;
                     // No AOS on individual items in table view to keep it cleaner/faster scroll

                     let priorityTag = '';
                     if (item.type === 'study' && item.priority) {
                          priorityTag = `<span class="priority-tag p${item.priority}">Prio ${item.priority}</span>`;
                          if (item.task.includes('EXAM J-')) {
                              priorityTag = `<span class="priority-tag p${item.task.indexOf('EXAM') > -1 ? 1 : item.priority}">${item.task.substring(item.task.indexOf('EXAM'))}</span>`; // Prio 1 for close exams
                          }
                      } else if (item.type === 'study' && item.task.includes('EXAM J-')) {
                          const match = item.task.match(/EXAM J-(\d+)/);
                          if (match && match[1] <= 3) {
                               priorityTag = `<span class="priority-tag p1">${item.task.substring(item.task.indexOf('EXAM'))}</span>`;
                          } else {
                              priorityTag = `<span class="priority-tag p3">${item.task.substring(item.task.indexOf('EXAM'))}</span>`;
                          }
                     } else if (item.type === 'exam') {
                          priorityTag = `<span class="priority-tag p1">EXAM</span>`;
                     }


                     const icon = item.type === 'study' ? '<i class="fas fa-book-open"></i>' :
                                  item.type === 'break' ? '<i class="fas fa-mug-hot"></i>' :
                                  item.type === 'free' ? '<i class="fas fa-smile"></i>' :
                                  item.type === 'exam' ? '<i class="fas fa-file-alt"></i>' : '';

                     const title = item.type === 'exam' ? item.task : item.module;
                     const description = item.type === 'exam' ? `Bonne chance ! Salle: À vérifier sur l'affichage officiel.` : item.task;


                     itemElement.innerHTML = `
                         <span class="item-timespan">${item.startTime} - ${item.endTime}</span>
                         <div class="item-title">${icon}${title} ${priorityTag}</div>
                         <div class="item-description">${description}</div>
                         ${item.type === 'study' ? `<label class="task-checkbox"><input type="checkbox" data-task-id="${item.id}" aria-label="Marquer cette tâche comme terminée"> Terminé</label>` : ''}
                          ${item.calendar ? `<div class="add-to-calendar"><button data-item-id="${item.id}"><i class="fas fa-calendar-plus"></i> Ajouter</button></div>` : ''}
                     `;
                      dayFragment.appendChild(itemElement);
                 });
                 dayColumn.querySelector('.day-content').appendChild(dayFragment);
                 fragment.appendChild(dayColumn);
             });

             tableViewContainer.appendChild(fragment);

             // Attach event listeners after rendering
             attachTaskCompletionListeners();
              attachCalendarButtonListeners();
              updateProgress(); // Update progress after rendering items
        }


        // --- Task Completion ---
        function getCompletedTasks() {
            const completedTasks = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('task_') && localStorage.getItem(key) === 'true') {
                    completedTasks[key.substring(5)] = true; // Store task ID
                }
            }
            return completedTasks;
        }

        function saveTaskCompletion(taskId, isCompleted) {
            if (isCompleted) {
                localStorage.setItem(`task_${taskId}`, 'true');
            } else {
                localStorage.removeItem(`task_${taskId}`);
            }
            updateTaskCompletionClasses(); // Update classes visually
             updateProgress(); // Update progress bars
        }

         function attachTaskCompletionListeners() {
              document.querySelectorAll('.task-checkbox input[type="checkbox"]').forEach(checkbox => {
                  // Prevent multiple listeners
                  if (checkbox.dataset.listenerAttached) {
                       return;
                  }
                  checkbox.dataset.listenerAttached = 'true'; // Mark as attached

                  checkbox.addEventListener('change', function() {
                      const taskId = this.dataset.taskId;
                      saveTaskCompletion(taskId, this.checked);
                  });
              });
         }

         function updateTaskCompletionClasses() {
             const completedTasks = getCompletedTasks();
             scheduleData.forEach(item => {
                  const elementTimeline = document.querySelector(`#timeline-view [data-item-id="${item.id}"]`);
                  const elementTable = document.querySelector(`#table-view [data-item-id="${item.id}"]`);

                  if (completedTasks[item.id]) {
                      if (elementTimeline) elementTimeline.classList.add('completed');
                      if (elementTable) elementTable.classList.add('completed');
                      const checkboxTimeline = elementTimeline?.querySelector('input[type="checkbox"]');
                       if (checkboxTimeline) checkboxTimeline.checked = true;
                      const checkboxTable = elementTable?.querySelector('input[type="checkbox"]');
                       if (checkboxTable) checkboxTable.checked = true;

                  } else {
                      if (elementTimeline) elementTimeline.classList.remove('completed');
                      if (elementTable) elementTable.classList.remove('completed');
                      const checkboxTimeline = elementTimeline?.querySelector('input[type="checkbox"]');
                       if (checkboxTimeline) checkboxTimeline.checked = false;
                      const checkboxTable = elementTable?.querySelector('input[type="checkbox"]');
                       if (checkboxTable) checkboxTable.checked = false;
                  }
             });
         }

         // --- Progress Tracking ---
         function updateProgress() {
             const studySessions = scheduleData.filter(item => item.type === 'study' || item.type === 'exam');
             const completedSessions = studySessions.filter(item => localStorage.getItem(`task_${item.id}`) === 'true' || item.type === 'exam').length; // Count exams as completed tasks
             const totalSessions = studySessions.length;

              // Overall Progress
             const overallPercentage = totalSessions > 0 ? Math.round((completedSessions / totalSessions) * 100) : 0;
             const overallBar = document.getElementById('overall-progress-bar');
             const overallText = document.getElementById('overall-progress-text');
             if (overallBar && overallText) {
                  overallBar.style.width = `${overallPercentage}%`;
                  overallText.textContent = `${completedSessions} / ${totalSessions} sessions (${overallPercentage}%) terminées`;
             }

             // Module Progress
             const moduleProgressContainer = document.getElementById('module-progress');
              if (!moduleProgressContainer) return;

             const moduleData = {};
             scheduleData.forEach(item => {
                 if (item.type === 'study' || item.type === 'exam') {
                      const moduleName = item.module;
                      if (!moduleData[moduleName]) {
                          moduleData[moduleName] = { total: 0, completed: 0, priority: item.priority || 3 }; // Default priority 3
                      }
                      moduleData[moduleName].total++;
                      if (localStorage.getItem(`task_${item.id}`) === 'true' || item.type === 'exam') { // Exams are auto-completed
                          moduleData[moduleName].completed++;
                      }
                      // Update priority if a higher priority item is found for the module
                      if (item.priority && item.priority < moduleData[moduleName].priority) {
                           moduleData[moduleName].priority = item.priority;
                      } else if (item.task.includes('EXAM J-') && moduleData[moduleName].priority > 1) {
                           const match = item.task.match(/EXAM J-(\d+)/);
                           if (match && match[1] <= 3) { // J-3 or less gets Prio 1 display
                                moduleData[moduleName].priority = 1;
                           } else if (match && match[1] > 3 && moduleData[moduleName].priority > 3) {
                                moduleData[moduleName].priority = 3; // Default for other exam J- days
                           }
                       } else if (item.type === 'exam' && moduleData[moduleName].priority > 1) {
                            moduleData[moduleName].priority = 1; // Exams are Prio 1
                       }


                 }
             });

             // Sort modules by priority (1 first, then 2, then 3) and then alphabetically
             const sortedModules = Object.keys(moduleData).sort((a, b) => {
                  if (moduleData[a].priority !== moduleData[b].priority) {
                      return moduleData[a].priority - moduleData[b].priority;
                  }
                  return a.localeCompare(b);
             });

             let moduleHtml = '<h5>Progression par Module (Sessions Terminées)</h5>';
             sortedModules.forEach(moduleName => {
                  const data = moduleData[moduleName];
                  const percentage = data.total > 0 ? Math.round((data.completed / data.total) * 100) : 0;
                  moduleHtml += `
                     <div>
                          <div class="module-name">${moduleName}</div>
                          <div class="module-progress-bar-container">
                              <div class="module-progress-bar" style="width: ${percentage}%;" data-priority="${data.priority}"></div>
                          </div>
                          <div class="module-progress-text">${data.completed} / ${data.total} sessions (${percentage}%)</div>
                     </div>
                  `;
             });

             moduleProgressContainer.innerHTML = moduleHtml;
         }


        // --- Live Clock, Countdown, Highlight ---
         function parseTime(timeStr) {
              const [hour, minute] = timeStr.split(':').map(Number);
              return { hour, minute };
         }

        function updateClock() {
            const now = new Date();
             // Ensure accurate current date without time zone issues
             const nowUTC = new Date(now.toUTCString());


            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };

            document.getElementById('current-time').textContent = now.toLocaleTimeString('fr-FR', timeOptions);
            document.getElementById('current-date').textContent = now.toLocaleDateString('fr-FR', dateOptions);

            updateCountdowns(nowUTC);
            highlightTimeline(nowUTC);
             updateWhatsNext(nowUTC);
        }

        function updateCountdowns(now) {
            const countdownElement = document.getElementById('countdown');
            const sessionCountdownElement = document.getElementById('current-session-countdown');

            // Find next exam
            let nextExam = null;
            for (const item of scheduleData) {
                if (item.type === 'exam' && item.startDateTime > now) {
                    if (!nextExam || item.startDateTime < nextExam.startDateTime) {
                        nextExam = item;
                    }
                }
            }

            if (nextExam) {
                const diff = nextExam.startDateTime.getTime() - now.getTime();
                 if (diff <= 0) {
                     countdownElement.innerHTML = `<i class="fas fa-check-circle mr-2 text-primary"></i> L'examen ${nextExam.module} est en cours ou vient de se terminer !`;
                 } else if (diff < 1000 * 60 * 60 * 24) {
                     const hours = Math.floor(diff / (1000 * 60 * 60));
                     const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                     const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                     countdownElement.innerHTML = `<i class="fas fa-exclamation-triangle mr-2 text-yellow-500"></i> Examen ${nextExam.module} très bientôt ! ${String(hours).padStart(2, '0')}h ${String(minutes).padStart(2, '0')}m ${String(seconds).padStart(2, '0')}s`;
                 }
                 else if (diff < 1000 * 60 * 60 * 24 * 3) {
                      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                      countdownElement.innerHTML = `<i class="fas fa-calendar-alt mr-2 text-orange-500"></i> Examen ${nextExam.module} dans ${days}j ${hours}h`;
                 }
                else {
                     const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                     countdownElement.innerHTML = `<i class="fas fa-calendar-alt mr-2 text-primary"></i> Prochain examen (${nextExam.module}) dans ${days} jours`;
                }

            } else {
                countdownElement.innerHTML = `<i class="fas fa-check-circle mr-2 text-primary"></i> Tous les examens sont terminés !`;
            }

             // Find current session
            let currentSession = null;
             for (const item of scheduleData) {
                  if (now >= item.startDateTime && now < item.endDateTime) {
                      currentSession = item;
                      break;
                  }
             }


             if (currentSession && currentSession.type !== 'exam') {
                 const sessionDiff = currentSession.endDateTime.getTime() - now.getTime();

                 if (sessionDiff > 0) {
                     const sessionMinutes = Math.floor((sessionDiff % (1000 * 60 * 60)) / (1000 * 60));
                     const sessionSeconds = Math.floor((sessionDiff % (1000 * 60)) / 1000);
                     sessionCountdownElement.innerHTML = `<i class="fas fa-circle-notch fa-spin"></i> Fin de session dans ${String(sessionMinutes).padStart(2, '0')}m ${String(sessionSeconds).padStart(2, '0')}s`;
                     sessionCountdownElement.classList.remove('hidden');
                 } else {
                      sessionCountdownElement.classList.add('hidden');
                 }
             } else {
                  sessionCountdownElement.classList.add('hidden');
             }
        }

         function updateWhatsNext(now) {
             const whatsNextSection = document.getElementById('whats-next');
             const nextTaskInfo = document.getElementById('next-task-info');

              // Find the first upcoming, not completed study or exam task
             let nextItem = null;
             for (const item of scheduleData) {
                 const isCompleted = localStorage.getItem(`task_${item.id}`) === 'true';
                 if ((item.type === 'study' && !isCompleted) || item.type === 'exam') { // Consider exams not completed by checkbox
                     if (item.startDateTime > now) {
                         nextItem = item;
                         break; // Found the first upcoming
                     }
                 }
             }

             if (nextItem) {
                 whatsNextSection.style.display = 'block';
                 const timeUntil = formatTimeDifference(nextItem.startDateTime.getTime() - now.getTime());
                 const icon = nextItem.type === 'study' ? '<i class="fas fa-book-open mr-2"></i>' : '<i class="fas fa-file-alt mr-2"></i>';
                 const module = nextItem.module;
                 const task = nextItem.task;
                 const timespan = `${nextItem.startTime} - ${nextItem.endTime}`;

                 nextTaskInfo.innerHTML = `${icon}<span class="next-time">${timespan}</span>: ${module} - ${task} <span class="next-countdown"><i class="fas fa-hourglass-half"></i> dans ${timeUntil}</span>`;

             } else {
                 whatsNextSection.style.display = 'none';
             }
         }

         function formatTimeDifference(diffMs) {
             if (diffMs < 0) return 'maintenant';
             const seconds = Math.floor(diffMs / 1000);
             const minutes = Math.floor(seconds / 60);
             const hours = Math.floor(minutes / 60);
             const days = Math.floor(hours / 24);

             if (days > 0) return `${days}j ${hours % 24}h`;
             if (hours > 0) return `${hours}h ${minutes % 60}m`;
             if (minutes > 0) return `${minutes}m ${seconds % 60}s`;
             return `${seconds}s`;
         }


        function highlightTimeline(now) {
            const todayStr = now.toISOString().split('T')[0];

            // Clear existing highlights and passed classes
            document.querySelectorAll('.current-day').forEach(el => el.classList.remove('current-day'));
             document.querySelectorAll('.current-session').forEach(el => el.classList.remove('current-session'));
             document.querySelectorAll('.passed').forEach(el => el.classList.remove('passed'));
             // Clear AOS classes that might prevent re-animation if view changes (manual approach)
             document.querySelectorAll('[data-aos]').forEach(el => el.classList.remove('aos-animate'));


            let currentDayElement = null;
            let currentSessionElement = null;

            // Iterate through data to apply classes to corresponding HTML elements
            scheduleData.forEach(item => {
                 const itemElementTimeline = document.querySelector(`#timeline-view [data-item-id="${item.id}"]`);
                 const itemElementTable = document.querySelector(`#table-view [data-item-id="${item.id}"]`);
                 const elements = [itemElementTimeline, itemElementTable].filter(el => el !== null); // Get existing elements for this item ID

                 elements.forEach(el => {
                     // Check if session is passed
                     if (now >= item.endDateTime) {
                          el.classList.add('passed');
                     } else {
                          el.classList.remove('passed');
                     }

                     // Check if session is current
                     if (now >= item.startDateTime && now < item.endDateTime) {
                         el.classList.add('current-session');
                         if (el === itemElementTimeline) currentSessionElement = itemElementTimeline; // Store timeline element for scrolling
                         // Note: Table view current session will be highlighted automatically by CSS
                     } else {
                          el.classList.remove('current-session');
                     }
                 });

                 // Check if day is current
                 if (item.date === todayStr) {
                     const dayElementTimeline = document.querySelector(`#timeline-view .day-item[data-date="${item.date}"]`);
                     const dayElementTable = document.querySelector(`#table-view .day-column[data-date="${item.date}"]`);

                     if (dayElementTimeline) {
                          dayElementTimeline.classList.add('current-day');
                           currentDayElement = dayElementTimeline; // Store timeline element for scrolling
                     }
                     if (dayElementTable) {
                          dayElementTable.classList.add('current-day');
                           // No need to store for table scroll, we scroll the container
                     }
                 }
            });

             // Re-apply AOS if needed (AOS.refresh might be better overall)
             // AOS.refreshHard();
        }


        function scrollToElement(element, view) {
             if (!element) return;

             const headerOffset = 80; // Account for header height
             const utilityButtonOffset = 60; // Account for buttons at the bottom right

             if (view === 'timeline') {
                 const elementPosition = element.getBoundingClientRect().top;
                 const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                 // Only scroll if the element is not already mostly in view
                 if (elementPosition < headerOffset + 20 || elementPosition > window.innerHeight - utilityButtonOffset - element.offsetHeight - 20) {
                      window.scrollTo({
                         top: offsetPosition,
                         behavior: 'smooth'
                      });
                 }
             } else if (view === 'table') {
                 const tableView = document.getElementById('table-view');
                 const elementPosition = element.offsetLeft; // Position relative to the scrolling container's left edge

                 // Calculate scroll position to center the element horizontally
                 const containerWidth = tableView.offsetWidth;
                 const elementWidth = element.offsetWidth;
                 const scrollLeft = elementPosition - (containerWidth / 2) + (elementWidth / 2);

                 // Only scroll if the element is not already mostly in view horizontally
                 const elementRight = element.offsetLeft + element.offsetWidth;
                 const containerScrollLeft = tableView.scrollLeft;
                 const containerScrollRight = containerScrollLeft + containerWidth;

                  if (element.offsetLeft < containerScrollLeft || elementRight > containerScrollRight ||
                      element.offsetLeft - containerScrollLeft < 50 || containerScrollRight - elementRight < 50) { // Add some buffer
                      tableView.scrollTo({
                          left: scrollLeft,
                          behavior: 'smooth'
                      });
                  }
             }
         }


        function scrollToCurrent(view) {
            // Find the first non-passed day or the current day
            const now = new Date(new Date().toUTCString());
            let targetDate = null;
            let targetItemId = null; // Prefer scrolling to current/next session

            // Find the first upcoming session that hasn't been marked complete
             for (const item of scheduleData) {
                 const isCompleted = localStorage.getItem(`task_${item.id}`) === 'true';
                  // Include exams here as well for potential scroll target
                 if (item.endDateTime > now && (item.type !== 'study' || !isCompleted)) {
                      // Check if current session
                     if (now >= item.startDateTime && now < item.endDateTime) {
                         targetItemId = item.id;
                         targetDate = item.date;
                         break; // Found the current session
                     }
                      // Check if it's the first upcoming session
                      if (!targetItemId && item.startDateTime > now) {
                          targetItemId = item.id;
                          targetDate = item.date;
                          // Don't break yet, maybe there's a current session later
                      }
                 }
             }

             // If no upcoming session found, scroll to the last item? or just stay put
             if (!targetItemId) {
                  const lastItem = scheduleData[scheduleData.length - 1];
                   if (lastItem) targetDate = lastItem.date; // Scroll to the last day if plan is over
             }

            // If no specific item, just scroll to the first non-passed day
            if (!targetDate) {
                 for (const dateKey of Object.keys(scheduleByDay).sort()) {
                      const dayEvents = scheduleByDay[dateKey];
                      const allPassed = dayEvents.every(item => {
                          // Consider tasks complete if checkbox is checked, exams complete by time
                           const isTask = item.type === 'study';
                           const isExam = item.type === 'exam';
                           if (isExam) return now >= item.endDateTime;
                           if (isTask) return localStorage.getItem(`task_${item.id}`) === 'true' || now >= item.endDateTime; // task is passed by time OR checked
                            // Breaks/Free time are passed by time
                           return now >= item.endDateTime;
                      });
                      if (!allPassed) {
                          targetDate = dateKey;
                          break;
                      }
                 }
             }

             // If still no target date (e.g., empty schedule or everything passed), default to first day
             if (!targetDate && Object.keys(scheduleByDay).length > 0) {
                  targetDate = Object.keys(scheduleByDay).sort()[0];
             }


            let elementToScrollTo = null;
            if (targetItemId) {
                // Try finding the specific item
                 elementToScrollTo = document.querySelector(`#${view}-view [data-item-id="${targetItemId}"]`);
            }

            if (!elementToScrollTo && targetDate) {
                 // If no specific item or item not found, scroll to the day header
                 if (view === 'timeline') {
                     elementToScrollTo = document.querySelector(`#${view}-view .day-item[data-date="${targetDate}"]`);
                 } else if (view === 'table') {
                     elementToScrollTo = document.querySelector(`#${view}-view .day-column[data-date="${targetDate}"]`);
                 }
            }


             if (elementToScrollTo) {
                 setTimeout(() => {
                    scrollToElement(elementToScrollTo, view);
                 }, 500); // Small delay to allow elements to render/AOS to initialize
             }
        }


        // --- Add to Calendar ---
        function generateICS(item) {
            const start = new Date(item.startDateTime).toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            const end = new Date(item.endDateTime).toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            const summary = item.type === 'exam' ? `Examen: ${item.module}` : `Révision: ${item.module}`;
            const description = item.task || item.module;
            const location = item.type === 'exam' ? "Université de Bejaia - Campus El-Kseur (Salle à vérifier)" : "Lieu de révision";

            const icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//Amara Mehdi Revision Plan//FR',
                'BEGIN:VEVENT',
                `UID:${item.id}@ecampus.mehdiamara.com`, // Unique ID
                `DTSTAMP:${new Date().toISOString().replace(/[-:]|(?:\.\d+)/g, '').split('.')[0] + 'Z'}`, // Timestamp
                `DTSTART:${start}`,
                `DTEND:${end}`,
                `SUMMARY:${summary}`,
                `DESCRIPTION:${description}`,
                `LOCATION:${location}`,
                'END:VEVENT',
                'END:VCALENDAR'
            ].join('\n');

            return 'data:text/calendar;charset=utf8,' + encodeURIComponent(icsContent);
        }

         function attachCalendarButtonListeners() {
              document.querySelectorAll('.add-to-calendar button').forEach(button => {
                  // Prevent multiple listeners
                  if (button.dataset.listenerAttached) {
                       return;
                  }
                  button.dataset.listenerAttached = 'true'; // Mark as attached

                   button.addEventListener('click', function() {
                       const itemId = this.dataset.itemId;
                       const item = scheduleData.find(d => d.id === itemId);
                       if (item) {
                           const icsDataUrl = generateICS(item);
                           const link = document.createElement('a');
                           link.href = icsDataUrl;
                           link.download = `${item.date.replace(/-/g, '')}_${item.startTime.replace(':', '')}_${item.module.replace(/[^a-zA-Z0-9]/g, '')}.ics`;
                           document.body.appendChild(link);
                           link.click();
                           document.body.removeChild(link);
                       } else {
                           console.error('Item not found for calendar export:', itemId);
                       }
                   });
              });
         }


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            applySavedTheme();
            createParticles();
            renderTimeline(); // Render initial view
            renderTable(); // Render the other view so elements exist for highlighting/completion
            applySavedView(); // Switch to saved view if needed

            // Initial highlight and scroll - must happen *after* rendering both views
             updateTaskCompletionClasses(); // Apply completion status from localStorage
             updateProgress(); // Calculate initial progress

             // Initial scroll based on saved view preference
             const initialView = localStorage.getItem('view') || 'timeline';
             scrollToCurrent(initialView);


            // Set daily quote
            setDailyQuote();

            // Update clock, countdown, and highlighting every second
            updateClock();
            setInterval(updateClock, 1000);

             // Attach view toggle listener
             document.getElementById('view-toggle').addEventListener('click', toggleView);

            // Attach theme toggle listener
             document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

             // Recreate particles on window resize
             window.addEventListener('resize', createParticles);

             // Handle scroll position saving/restoring more robustly if needed
             // Current scroll-to-current logic handles initial load.
        });

        // --- Helper: Set daily motivational quote ---
        function setDailyQuote() {
            const quoteElement = document.getElementById('daily-quote');
            if (quoteElement) {
                const today = new Date();
                const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
                // Add an offset (e.g., 42) to start from a different quote each year
                const quoteIndex = (dayOfYear + 100) % motivationalQuotes.length;
                quoteElement.textContent = motivationalQuotes[quoteIndex];
            }
        }

        // Firebase configuration is commented out as requested
        // console.log("Firebase config loaded, but initialization is commented out.");

    </script>

</body>
</html>
